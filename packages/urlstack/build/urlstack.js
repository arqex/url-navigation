!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.urlstack=e():t.urlstack=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(8),o=n(9),a=/([^=?&]+)=?([^&]*)/g;e.stringify=function(t,e){e&&(t=r.flatten(t));var n=Object.keys(t);if(!n.length)return"";for(var o=0,a=n.length;o<a;o++){var i=n[o];n[o]=encodeURIComponent(i)+"="+encodeURIComponent(t[i])}return n.join("&")},e.parse=function(t,e){for(var n=e?o.deep:o.shallow,r={};;){var i=a.exec(t);if(!i)break;var c=i[1],s=i[2];n(r,decodeURIComponent(c),decodeURIComponent(s))}return r}},function(t,e,n){var r,o=n(6),a=n(0);"undefined"!=typeof window&&(r=function(t){var e=document.createElement("a");return e.href=t,e});var i={create:function(t){return new c(t)},joinUrls:h},c=function(t){if(!t||!t.strategy)throw new Error("Router needs an strategy to listen to url changes.");var e=t.strategy,n={};Object.keys(t).forEach(function(e){"strategy"!==e&&(n[e]=t[e])}),e.init&&e.init(n),this.strategy=e,this.obc=[],this.cbs=[]},s={setRoutes:function(t){this.routes=this.parseRoutes(t)},parseRoutes:function(t,e){t||console.warn("No routes provided to parseRoutes"),t.length||(t=[t]);var n=[],r=this;return t.forEach(function(t){var a=h(e,t.path),i=[],c={regex:o(a,i),id:a,cb:t.cb};c.params=i.map(function(t){return t.name}),t.children&&t.children.length&&(c.childRegex=o(a,[],{end:!1}),c.children=r.parseRoutes(t.children,a)),n.push(c)}),n},match:function(t,e,n){var o,i,c,s,u=0,h=f(t);e||(e=this.routes);var l=(this.strategy.parseUrl||r)(h);for("/"!==(o=l.pathname)[0]&&(o="/"+o);u<e.length&&!i;){if((s=e[u]).childRegex&&(i=s.childRegex.exec(o))){if(c=this.match(h,s.children,!0),c.matches.length)return c.matches=[s.cb].concat(c.matches),c.matchIds=[s.id].concat(c.matchIds),c;i=!1}(i=s.regex.exec(o))&&(i={id:s.id,cb:s.cb,params:i.slice(1)}),i||u++}var p=[],d=[];return i?(p.push(i.cb),d.push(i.id)):n||console.error("There is no route match for "+t),c={matches:p,matchIds:d,pathname:o,search:l.search,query:a.parse(l.search),hash:l.hash,route:i&&i.id||!1,params:{}},i&&s.params.forEach(function(t,e){c.params[t]=i.params[e]}),c},start:function(){var t=this;return this.strategy.onChange(function(){var e=t.checkChange();e.next&&(e.current!==e.next?t.strategy.replace(e.next):(t.location=e.nextLocation,t.cbs.forEach(function(t){t(e.nextLocation)})))}),this.strategy.start(),this.location=this.match(this.strategy.getLocation()),this.location},stop:function(){this.strategy.onChange(function(){})},refresh:function(){var t=this.checkChange();t.next&&t.current!==t.next&&this.strategy.replace(t.next)},checkChange:function(){var t=this.strategy.getLocation(),e=this.runOnBeforeChange(this.match(t));return{current:t,next:e&&e.pathname+e.search+e.hash,nextLocation:e}},runOnBeforeChange:function(t){var e=this;return this.obc.forEach(function(n){t&&"string"==typeof(t=n(t))&&(t=e.match(t))}),t},onBeforeChange:function(t){this.obc.push(t)},onChange:function(t){this.cbs.push(t)},push:function(t){this.updateLocation("push",t)},replace:function(t){this.updateLocation("replace",t)},back:function(){this.strategy.back()},updateLocation:function(t,e){var n,r=this.strategy.getLocation();n="string"==typeof e?e:function(t,e){var n=Object.assign(t,e),r=n.search;r=Object.keys(n.query).length?"?"+a.stringify(n.query):"";return n.pathname+r+n.hash}(this.match(r),e);var o=this.runOnBeforeChange(this.match(n));o&&r!==(n=o.pathname+o.search+o.hash)&&this.strategy[t](n)}};for(var u in s)c.prototype[u]=s[u];function h(t,e){var n=f(t),r=f(e);return t?e?"/"===n?r:"/"===r?n:n+r:n:r}function f(t){if(!t)return"/";var e=t;return"/"===e[e.length-1]&&(e=e.slice(0,e.length-1)),"/"!==e[0]&&(e="/"+e),e}t.exports=i},function(t,e,n){var r=n(0),o=function(){},a={init:function(t){this.history=[t.initialLocation||"/"]},start:function(){this.emit()},push:function(t){this.history.push(t),this.emit()},replace:function(t){this.history[this.history.length]=t,this.emit()},onChange:function(t){o=t},getLocation:function(){return this.history[this.history.length-1]},emit:function(){o&&o(this.getLocation())},parseUrl:function(t){var e=t.split("?"),n=e[1]?e[1].split("#"):[];return{pathname:e[0],search:n[0]?"?"+n[0]:"",hash:n[1]?"#"+n[1]:"",query:n[0]?r.parse(n[0]):{}}},back:function(){this.history.length>1&&this.history.pop(),this.emit()}};t.exports=a},function(t,e){var n=function(){},r={init:function(t){},start:function(){var t=this;location.hash||(location.hash="#/"),window.onhashchange=function(){t.emit()},t.emit()},push:function(t){window.location.hash="#"+t},replace:function(t){var e=location.protocol+"//"+location.host+location.pathname+"#"+t;location.replace(e)},onChange:function(t){n=t},getLocation:function(){return location.hash?"/"!==location.hash[1]?"/"+location.hash:location.hash.slice(1):"/"},emit:function(){n(this.getLocation())},back:function(){window.history.back()}};t.exports=r},function(t,e){var n=function(){},r={init:function(t){this.basePath=t.basePath||"","/"===this.basePath.slice(-1)&&(this.basePath=this.basePath.slice(0,-1))},start:function(){var t=this;window.onpopstate=function(){t.emit()},t.emit()},push:function(t){history.pushState({},"",this.basePath+t),this.emit()},replace:function(t){history.replaceState({},"",this.basePath+t),this.emit()},onChange:function(t){n=t},getLocation:function(){var t=location.pathname+location.search+location.hash,e=this.basePath.length;return t.slice(0,e)===this.basePath&&(t=t.slice(e)),t},emit:function(){n&&n(this.getLocation())},back:function(){window.history.back()}};t.exports=r},function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return p});var r=n(1),o=n.n(r),a=n(2),i=n.n(a),c=n(3),s=n.n(c),u=n(4),h=n.n(u);function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){l(t,e,n[e])})}return t}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function p(t,e){var n;n="undefined"==typeof document?i.a:e&&"hash"===e.strategy?s.a:h.a;var r=o.a.create({strategy:n}),a=[],c={urlhub:r,stack:[],activeIndex:-1,_nestedStack:[],_lastNavigated:[],modal:{active:!1,stack:[],activeIndex:-1},onChange:function(t){a.push(t)},navigate:function(t){t===this._lastNavigated[this._lastNavigated.length-2]?(this._lastNavigated.pop(),r.push.apply(r,arguments)):(this._lastNavigated.push(t),r.push.apply(r,arguments))}};return r.setRoutes(t),r.onChange(function(t,e,n){var r=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";var r={};e.forEach(function(e){var o=n+e.path;if(r[o]=e,e.children){var a=t(e.children,o);r=f({},r,a)}});return r}(e);return function(e){var o=e.pathname+e.search+e.hash;o!==t._lastNavigated[t._lastNavigated.length-1]&&(t._lastNavigated=[]);var a=d(e,r),i=y(t._nestedStack||[],a,r),c=i.stack,s=i.index;!function t(e,n,r,o){if(n[0].length)e.stack=n[0],e.activeIndex=Math.max(0,Math.min(r,n[0].length-1)),e.modal&&(e.modal.active=!1);else if(!e.stack.length){var a=o[n[1][0].route].backgroundRoute||"/*",i=e.urlhub.match(a),c=y([],d(i,o),o),s=c.stack,u=c.index;e.stack=s,e.activeIndex=u}n.length>1&&(e.modal||(e.modal={stack:[],activeIndex:0}),e.modal.active=r>=0,t(e.modal,n.slice(1),r-n[0].length,o))}(t,function(t){var e=[],n=[];t.forEach(function(t){t.isModal?(e.push(n),n=[t]):n.push(t)}),n.length&&e.push(n);return e}(c),s,r),t.location=e,t._nestedStack=c,n.forEach(function(t){return t(e)})}}(c,t,a)),["start","stop","onBeforeChange","replace"].forEach(function(t){c[t]=function(){return this.urlhub[t].apply(this.urlhub,arguments)}}),c}function d(t,e){var n=t.matchIds,r=!1,o=[];return n.forEach(function(n){var a=e[n];if(r)return r.tabs.activeIndex=function(t,e){var n=e.length;for(;n--;)if(e[n].route===t)return n;return 0}(n,r.tabs.stack),void(r=!1);var i=g(n,t,a);i.isTabs&&(i.tabs={activeIndex:0,stack:e[i.route].children.map(function(r){return g(n+r.path,t,e[n+r.path])})},r=i),o.push(i)}),r&&(r.tabs.stack.length||console.warn("Urlstack: Hit a tabs URL without any children: "+tabScreen.path)),o}function g(t,e,n){return{Screen:n.cb,route:t,isTabs:!!n.isTabs,isModal:!!n.isModal,location:e,path:v(t,e.pathname),key:(r=Math.floor(1e5*Math.random()),"j"+r.toString(36))};var r}function v(t,e){var n=t.split("/"),r=e.split("/"),o=[];return n.forEach(function(t,e){o.push(r[e]||t)}),o.join("/")}function y(t,e,n){for(var r=[],o=0,a=!0,i=t[0],c=e[0];i||c;)a&&i&&c?i.Screen===c.Screen?(r.push(b(i,c,n)),i.path!==c.path&&(a=!1)):(a=!1,r.push(c)):a&&i?r.push(i):c&&r.push(c),i=t[++o],c=e[o];return{stack:r,index:e.length-1}}function b(t,e,n){var r=f({},e,{key:t.key});if(r.tabs){var o=[],a=r.tabs.activeIndex;t.tabs.stack.forEach(function(t,n){o.push(n===a?e.tabs.stack[n]:t),o[n].key=t.key,o[n].visited=t.visited||n===a}),r.tabs={stack:o,activeIndex:a}}return r}},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=n(7);t.exports=d,t.exports.parse=i,t.exports.compile=function(t,e){return s(i(t,e))},t.exports.tokensToFunction=s,t.exports.tokensToRegExp=p;var a=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function i(t,e){for(var n,r=[],o=0,i=0,c="",s=e&&e.delimiter||"/";null!=(n=a.exec(t));){var f=n[0],l=n[1],p=n.index;if(c+=t.slice(i,p),i=p+f.length,l)c+=l[1];else{var d=t[i],g=n[2],v=n[3],y=n[4],b=n[5],m=n[6],x=n[7];c&&(r.push(c),c="");var k=null!=g&&null!=d&&d!==g,w="+"===m||"*"===m,j="?"===m||"*"===m,O=n[2]||s,S=y||b;r.push({name:v||o++,prefix:g||"",delimiter:O,optional:j,repeat:w,partial:k,asterisk:!!x,pattern:S?h(S):x?".*":"[^"+u(O)+"]+?"})}}return i<t.length&&(c+=t.substr(i)),c&&r.push(c),r}function c(t){return encodeURI(t).replace(/[\/?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function s(t){for(var e=new Array(t.length),n=0;n<t.length;n++)"object"===r(t[n])&&(e[n]=new RegExp("^(?:"+t[n].pattern+")$"));return function(n,r){for(var a="",i=n||{},s=(r||{}).pretty?c:encodeURIComponent,u=0;u<t.length;u++){var h=t[u];if("string"!=typeof h){var f,l=i[h.name];if(null==l){if(h.optional){h.partial&&(a+=h.prefix);continue}throw new TypeError('Expected "'+h.name+'" to be defined')}if(o(l)){if(!h.repeat)throw new TypeError('Expected "'+h.name+'" to not repeat, but received `'+JSON.stringify(l)+"`");if(0===l.length){if(h.optional)continue;throw new TypeError('Expected "'+h.name+'" to not be empty')}for(var p=0;p<l.length;p++){if(f=s(l[p]),!e[u].test(f))throw new TypeError('Expected all "'+h.name+'" to match "'+h.pattern+'", but received `'+JSON.stringify(f)+"`");a+=(0===p?h.prefix:h.delimiter)+f}}else{if(f=h.asterisk?encodeURI(l).replace(/[?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()}):s(l),!e[u].test(f))throw new TypeError('Expected "'+h.name+'" to match "'+h.pattern+'", but received "'+f+'"');a+=h.prefix+f}}else a+=h}return a}}function u(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function h(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function f(t,e){return t.keys=e,t}function l(t){return t.sensitive?"":"i"}function p(t,e,n){o(e)||(n=e||n,e=[]);for(var r=(n=n||{}).strict,a=!1!==n.end,i="",c=0;c<t.length;c++){var s=t[c];if("string"==typeof s)i+=u(s);else{var h=u(s.prefix),p="(?:"+s.pattern+")";e.push(s),s.repeat&&(p+="(?:"+h+p+")*"),i+=p=s.optional?s.partial?h+"("+p+")?":"(?:"+h+"("+p+"))?":h+"("+p+")"}}var d=u(n.delimiter||"/"),g=i.slice(-d.length)===d;return r||(i=(g?i.slice(0,-d.length):i)+"(?:"+d+"(?=$))?"),i+=a?"$":r&&g?"":"(?="+d+"|$)",f(new RegExp("^"+i,l(n)),e)}function d(t,e,n){return o(e)||(n=e||n,e=[]),n=n||{},t instanceof RegExp?function(t,e){var n=t.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)e.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return f(t,e)}(t,e):o(t)?function(t,e,n){for(var r=[],o=0;o<t.length;o++)r.push(d(t[o],e,n).source);return f(new RegExp("(?:"+r.join("|")+")",l(n)),e)}(t,e,n):function(t,e,n){return p(i(t,n),e,n)}(t,e,n)}},function(t,e){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Object.prototype,o=r.toString,a=r.hasOwnProperty,i="[object Object]",c="[object Array]";function s(t,e){return null!=t?t+"["+e+"]":e}e.flatten=function t(e,n,r){var u=o.call(e);if(void 0===r)if(u===i)r={};else{if(u!==c)return;r=[]}for(var h in e)if(a.call(e,h)){var f=e[h];if(null!=f)switch(o.call(f)){case c:case i:t(f,s(n,h),r);break;default:r[s(n,h)]=f}}return r}},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0});var o=/[^\[\]]+|\[\]/g,a=/^\d+$/,i=[];function c(t,e){for(var n=-1,r=t.length;r--;){var o=t[r];if(0===o.indexOf(e)){var a=Number(o.replace(e,"").slice(1,o.indexOf("]")-1));a>n&&(n=a)}}return n+1}e.deep=function(t,e,n){for(var c,s,u,h=""===e?[""]:e.match(o),f=h.length,l=t,p=0;p<f;p++){c=l,s=h[p];var d=h[p+1];"[]"===s&&(s=l.length),l=(u="object"===r(l)&&s in l)?l[s]:l[s]="[]"===d||a.test(d)?[]:{}}return c[s]=u?i.concat(l,n):n,t},e.shallow=function(t,e,n){return t[e=function(t,e){var n=e.split("[]");if(1===n.length)return e;for(var r=n[0],o=Object.keys(t),a=1,i=n.length;a<i;a++)r+="["+c(o,r)+"]"+n[a];return r}(t,e)]=e in t?i.concat(t[e],n):n,t}}])});