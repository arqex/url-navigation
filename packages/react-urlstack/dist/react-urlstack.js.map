{"version":3,"file":"react-urlstack.js","sources":["../src/utils/utils.js","../src/defaultTransitions/tabTransition.js","../src/utils/animatedStyles.js","../src/utils/wrapperContext.js","../src/ScreenWrapper.js","../src/TransitionElement.js","../src/utils/sharedElementContext.js","../src/ScreenStack.js","../src/ModalWrapper.js","../src/DrawerWrapper.js","../src/defaultTransitions/desktopTransition.js","../src/defaultTransitions/mobileTransition.js","../src/defaultTransitions/modalTransition.js","../src/Navigator.js","../src/SharedElement.js"],"sourcesContent":["export function memoize( fn ){\n\tvar args, value;\n\n\tfunction recalculate( fnArgs ){\n\t\targs = fnArgs\n\t\tvalue = fn.apply( null, fnArgs )\n\t\treturn value;\n\t}\n\n\treturn function memoized(){\n\t\tif( !args || args.length !== arguments.length ){\n\t\t\treturn recalculate( arguments )\n\t\t}\n\n\t\tlet i = 0;\n\t\twhile( i < args.length ){\n\t\t\tif( args[i] !== arguments[i] ){\n\t\t\t\treturn recalculate( arguments )\n\t\t\t}\n\t\t\ti++\n\t\t}\n\n\t\treturn value\n\t}\n}\n\nexport function createId(){\n  return Math.round( Math.random() * 10000000 ).toString(36);\n}\n\nexport function nofn(){}\n\nexport function bind( that, methods ){\n\tmethods.forEach( m => {\n\t\tthat[m] = that[m].bind(that)\n\t})\n}\n","import { Easing } from 'react-native'\n\nexport default {\n\tstyles: function tabDefaultTransition( indexes, layout ) {\n\t\tlet scroll = layout.width / 2\n\t\treturn {\n\t\t\ttranslateX: {\n\t\t\t\tinputRange: [-2, -1, 0, 1, 2],\n\t\t\t\toutputRange: [scroll, scroll, 0, -scroll, -scroll]\n\t\t\t},\n\t\t\topacity: {\n\t\t\t\tinputRange: [-2, -1, 0, .8, 1],\n\t\t\t\toutputRange: [0, 0, 1, 0, 0]\n\t\t\t},\n\t\t}\n\t},\n\teasing: Easing.linear,\n\tduration: 300\n}","import { Animated } from 'react-native';\n\nexport function animatedStyles( transition, indexes, layout ){\n\tlet styles = typeof transition.styles === 'function' ? transition.styles( indexes, layout ) : transition.styles;\n\tif( !styles ){\n\t\tstyles = {}\n\t}\n\n\tlet animatedStyles = {}\n\tlet transformStyles = []\n\n\tif( indexes.count ){\n\t\tanimatedStyles.zIndex = indexes.count - Math.abs(indexes.relative)\n\t}\n\n\tObject.keys( styles ).forEach( key => {\n\t\tlet value = styles[key];\n\n\t\tif( styleKeys[key] ){\n\t\t\tif( warnKeys[key] ){\n\t\t\t\tconsole.warn(`react-urlstack: It's possible in web, but react-native won't animate the property \"${key}\"`)\n\t\t\t}\n\t\t\tif( value && value.inputRange ){\n\t\t\t\tanimatedStyles[ key ] = indexes.transition.interpolate( value )\n\t\t\t}\n\t\t\telse {\n\t\t\t\tanimatedStyles[ key ] = value\n\t\t\t}\n\t\t}\n\t\telse if( transformKeys[key] ){\n\t\t\t// Check values\n\t\t\tlet type = transformKeys[key];\n\t\t\tlet warned = false;\n\t\t\tif( value && value.outputRange ){\n\t\t\t\tstyles[key].outputRange.forEach( value =>{\n\t\t\t\t\tif( !warned && typeof value !== type ){\n\t\t\t\t\t\twarned = true;\n\t\t\t\t\t\tconsole.warn(`react-urlstack: Even if it works in web, react-native only accepts type \"${transformKeys[key]}\" for \"${key}\". Given \"${ value }\".`);\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\ttransformStyles.push({\n\t\t\t\t\t[key]: indexes.transition.interpolate( value )\n\t\t\t\t})\n\t\t\t}\n\t\t\telse {\n\t\t\t\ttransformStyles.push({\n\t\t\t\t\t[key]: value\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tconsole.warn(`react-urlstack: Unknown property to animate \"${key}\"`)\n\t\t}\n\t})\n\n\tif( transformStyles.length ){\n\t\tanimatedStyles.transform = transformStyles\n\t}\n\n\treturn animatedStyles\n}\n\n\nlet styleKeys = {};\nlet warnKeys = {};\n['left', 'right', 'top', 'bottom'].forEach( key => {\n\tstyleKeys[key] = 1;\n\twarnKeys[key] = 1;\n});\n['width', 'height', 'opacity', 'backgroundColor', 'borderRadius'].forEach( key => {\n\tstyleKeys[key] = 1 \n})\n\nlet n = 'number', s = 'string';\nlet transformKeys = {\n\tperspective: n,\n\trotate: s, rotateX: s, rotateY: s, rotateZ: s,\n\tscale: n, scaleX: n, scaleY: n,\n\ttranslateX: n, translateY: n,\n\tskeyX: s, skewY: s\n};\n\n\nexport function stagger( animatedValue, gap, times, styles ){\n\tlet follower = new Animated.Value( animatedValue._value );\n\tAnimated.timing( follower, {duration: 0, toValue: animatedValue} ).start();\n\t\n\tlet stagged = [ animatedStyles({styles}, {transition: follower}) ];\n\n\tfor( let i = 1; i < times; i++ ){\n\t\tlet stage = {};\n\t\tObject.keys( styles ).forEach( attr => {\n\t\t\tlet val = styles[attr];\n\t\t\tif( val && val.inputRange ){\n\t\t\t\tlet shifted = {\n\t\t\t\t\tinputRange: [],\n\t\t\t\t\toutputRange: val.outputRange\n\t\t\t\t}\n\t\t\t\tval.inputRange.forEach( inputValue => {\n\t\t\t\t\tshifted.inputRange.push( inputValue + (i * gap) )\n\t\t\t\t})\n\t\t\t\tstage[attr] = shifted;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tstage[attr] = val;\n\t\t\t}\n\t\t})\n\n\t\tlet animated = animatedStyles({styles: stage}, {transition: follower});\n\t\tstagged.push( animated );\n\t}\n\n\treturn stagged;\n}","import React from 'react';\n\nconst Context = React.createContext();\n\nexport default Context;","import React, {Component} from 'react'\nimport { StyleSheet, Animated } from 'react-native'\nimport tabTransition from './defaultTransitions/tabTransition'\nimport {animatedStyles} from './utils/animatedStyles'\nimport Context from './utils/wrapperContext'\nimport {createId, nofn} from './utils/utils'\n\nexport default class ScreenWrapper extends Component {\n\tconstructor(props){\n\t\tsuper(props)\n\n\t\tthis.id = createId()\n\n\t\tthis.setAnimatedLayout( props.indexes, props.layout )\n\t}\n\n\tstatic defaultProps ={\n\t\tonReady: nofn,\n\t\tonUnmount: nofn\n\t}\n\n\trender(){\n\t\tlet item = this.props.item\n\t\tlet containerStyles = [\n\t\t\tstyles.container,\n\t\t\tthis.animatedStyles\n\t\t]\n\t\tlet contextValue = {\n\t\t\ttransition: this.props.transition,\n\t\t\tindexes: this.props.indexes,\n\t\t\tid: item.key\n\t\t}\n\n\t\treturn (\n\t\t\t<Animated.View style={ containerStyles } onLayout={ () => this.props.onReady( item.key ) }>\n\t\t\t\t<Context.Provider value={contextValue}>\n\t\t\t\t\t{ this.renderScreen() }\n\t\t\t\t</Context.Provider>\n\t\t\t</Animated.View>\n\t\t)\n\t}\n\n\trenderScreen(){\n\t\tlet { item, ScreenStack, router, transition, indexes, layout, drawer, breakPoint, navProps } = this.props;\n\t\tlet { Screen, location } = item;\n\n\t\tif( item.isTabs ){\n\t\t\treturn (\n\t\t\t\t<Screen router={router}\n\t\t\t\t\tlocation={location}\n\t\t\t\t\tindexes={indexes}\n\t\t\t\t\tlayout={layout}\n\t\t\t\t\tdrawer= { drawer }\n\t\t\t\t\tbreakPoint={ breakPoint }\n\t\t\t\t\t{ ...navProps } >\n\t\t\t\t\t<ScreenStack router={ router }\n\t\t\t\t\t\tisTabs={ true }\n\t\t\t\t\t\tscreenTransition={ transition.tabTransition || tabTransition }\n\t\t\t\t\t\tstack={ item.tabs.stack }\n\t\t\t\t\t\tindex={ item.tabs.activeIndex }\n\t\t\t\t\t\tparentIndexes={ indexes }\n\t\t\t\t\t\tlayout={ layout }\n\t\t\t\t\t\tbreakPoint={ breakPoint }\n\t\t\t\t\t\tnavProps={ navProps } />\n\t\t\t\t</Screen>\n\t\t\t)\n\t\t}\n\n\t\treturn (\n\t\t\t<Screen router={router}\n\t\t\t\tlocation={location}\n\t\t\t\tindexes={indexes}\n\t\t\t\tlayout={layout}\n\t\t\t\tdrawer= { drawer }\n\t\t\t\tbreakPoint={ breakPoint }\n\t\t\t\t{...navProps} />\n\t\t)\n\t}\n\t\n\tsetAnimatedLayout( indexes, layout ){\n\t\tlet transition = this.props.transition;\n\t\tthis.animatedStyles = transition ? animatedStyles( transition, indexes, layout ) : {};\n\t}\n\n\tcomponentWillReceiveProps( nextProps ){\n\t\tif( this.hasLayoutChanged( nextProps ) ){\n\t\t\tthis.setAnimatedLayout( nextProps.indexes, nextProps.layout );\n\t\t}\n\t}\n\n\thasLayoutChanged( nextProps ){\n\t\tif( !nextProps.indexes ) return;\n\t\t\n\t\tlet { width } = nextProps.layout;\n\t\tlet { screen, relative } = nextProps.indexes;\n\t\tlet { layout, indexes } = this.props;\n\n\t\treturn (\n\t\t\twidth !== layout.width ||\n\t\t\tscreen !== indexes.screen ||\n\t\t\trelative !== indexes.relative ||\n\t\t\tthis.props.transition !== nextProps.transition\n\t\t)\n\t}\n\n\tcomponentWillUnmount(){\n\t\tthis.props.onUnmount( this.props.item.key )\n\t}\n}\n\nlet styles = StyleSheet.create({\n\tcontainer: {\n\t\toverflow: 'hidden',\n\t\tposition: 'absolute',\n\t\ttop: 0, left: 0, bottom: 0, right: 0,\n\t\tzIndex:10\n\t}\n})","import React, { Component } from 'react';\nimport { Animated, StyleSheet, Platform } from 'react-native';\nimport {animatedStyles} from './utils/animatedStyles';\nimport PropTypes from 'prop-types'\n\nconst isWeb = Platform.OS === 'web';\nconst defaultDuration = 500;\n\nexport default class TransitionElement extends Component {\n\tstatic propTypes = {\n\t\t/** The entering props and box */\n\t\tentering: PropTypes.object, // {props, box}\n\t\t/** The leaving props and box */\n\t\tleaving: PropTypes.object, // {props, box}\n\t\t/** The breakpoint width from the navigator */\n\t\tbreakPoint: PropTypes.number,\n\t\t/** Screen indexes involved in the transition. If no transitionState is given in the SharedElement props, these values will be used as start and end points for  */\n\t\tscreenIndexes: PropTypes.object // {entering, leaving}\n\t}\n\n\tconstructor( props ){\n\t\tsuper(props);\n\n\t\tthis.indexes = this.getIndexes();\n\t\tthis.animatedValue = new Animated.Value( this.indexes.leaving );\n\t\tthis.transition = this.getTransition();\n\t}\n\n\trender(){\n\t\t// If the styles returned false, we don't want the transition \n\t\tif( this.transition === false ){\n\t\t\treturn null;\n\t\t}\n\n\t\tlet transitionStyles = [\n\t\t\tstyles.container,\n\t\t\tthis.props.leaving.props.style,\n\t\t\tanimatedStyles( this.transition, {transition: this.animatedValue} )\n\t\t]\n\t\t\n\t\treturn (\n\t\t\t<Animated.View style={ transitionStyles } pointerEvents=\"auto\">\n\t\t\t\t{ this.renderChildren() }\n\t\t\t</Animated.View>\n\t\t)\n\t}\n\n\trenderChildren(){\n\t\tlet props = this.props;\n\t\tlet customRenderer = props.leaving.props.transitionRender;\n\n\t\tif( customRenderer ){\n\t\t\treturn customRenderer({\n\t\t\t\tanimatedValue: this.animatedValue,\n\t\t\t\tbreakPoint: props.breakPoint,\n\t\t\t\tentering: props.entering,\n\t\t\t\tleaving: props.leaving\n\t\t\t})\n\t\t}\n\n\t\treturn props.leaving.props.children;\n\t}\n\n\tgetTransition(){\n\t\tlet transitionStyle = this.props.leaving.props.transition;\n\t\tlet defaultTransition = this.getDefaultTransition()\n\n\t\tlet transition\n\t\t\n\t\tif( typeof transitionStyle === 'function' ){\n\t\t\tlet props = this.props\n\t\t\ttransition = transitionStyle( {\n\t\t\t\tbreakPoint: props.breakPoint,\n\t\t\t\tentering: props.entering,\n\t\t\t\tleaving: props.leaving,\n\t\t\t\tdefaultTransition: { ...defaultTransition }\n\t\t\t})\n\t\t}\n\t\telse {\n\t\t\ttransition = transitionStyle;\n\t\t}\n\n\t\tif( transition === false ){\n\t\t\treturn false;\n\t\t}\n\t\telse if( transition === undefined ){\n\t\t\treturn defaultTransition\n\t\t}\n\n\t\t// Let's fill the gaps in the transitions\n\t\tif( !transition.duration ){\n\t\t\ttransition.duration = defaultTransition.duration;\n\t\t}\n\t\t\n\t\tlet styles = transition.styles;\n\t\tlet defaultStyles = defaultTransition.styles;\n\n\t\tif( !styles ){\n\t\t\tstyles = {}\n\t\t\ttransition.style = styles\n\t\t}\n\n\t\tObject.keys(defaultStyles).forEach(key => {\n\t\t\tif (styles[key] === undefined) {\n\t\t\t\tstyles[key] = defaultStyles[key]\n\t\t\t}\n\t\t})\n\n\t\treturn transition;\n\t}\n\n\tgetIndexes(){\n\t\treturn {\n\t\t\tentering: this.props.entering.props.transitionState || this.props.screenIndexes.entering,\n\t\t\tleaving: this.props.leaving.props.transitionState || this.props.screenIndexes.leaving,\n\t\t}\n\t}\n\n\t// The default transition is just a translation\n\tgetDefaultTransition(){\n\t\tlet {leaving, entering} = this.indexes;\n\t\tlet leavingBox = this.props.leaving.box;\n\t\tlet enteringBox = this.props.entering.box;\n\t\tlet leavingTransition = this.props.leavingTransition\n\n\t\treturn {\n\t\t\tstyles: {\n\t\t\t\twidth: this.getInterpolation( leaving, entering, leavingBox.width, enteringBox.width ),\n\t\t\t\theight: this.getInterpolation( leaving, entering, leavingBox.height, enteringBox.height ),\n\t\t\t\ttranslateX: this.getInterpolation( leaving, entering, leavingBox.x, enteringBox.x ),\n\t\t\t\ttranslateY: this.getInterpolation( leaving, entering, leavingBox.y, enteringBox.y ),\n\t\t\t},\n\t\t\tduration: (leavingTransition && leavingTransition.duration) || defaultDuration\n\t\t}\n\t}\n\n\tgetInterpolation( fromIndex, toIndex, fromValue, toValue ){\n\t\tif( fromValue === toValue ) return fromValue;\n\t\tlet inverted = fromIndex > toIndex;\n\t\treturn {\n\t\t\tinputRange: inverted ? [ toIndex, fromIndex ] : [ fromIndex, toIndex ],\n\t\t\toutputRange: inverted ? [ toValue, fromValue ] : [ fromValue, toValue ]\n\t\t}\n\t}\n\n\tcomponentDidMount(){\n\t\tconsole.log( 'Mounted', this.props.entering.box, this.props.leaving.box );\n\n\t\tif( this.transition !== false ){\n\t\t\t// Start the animation\n\t\t\tAnimated.timing( this.animatedValue, {\n\t\t\t\ttoValue: this.indexes.entering,\n\t\t\t\tduration: this.transition.duration || defaultDuration,\n\t\t\t\t// useNativeDriver: !isWeb // Native driver is not animating width and height\n\t\t\t}).start( () => this.props.onTransitionEnd() );\n\t\t}\n\t}\n}\n\n\nconst styles = StyleSheet.create({\n\tcontainer: { position: 'absolute', overflow: 'hidden', top: 0, left: 0 }\n})","import React, {Component} from 'react'\nimport TransitionElement from '../TransitionElement'\nimport {View, StyleSheet} from 'react-native'\nimport {createId} from './utils'\n\nconst Context = React.createContext('sharedElement');\n\n// We will be storing the mounted elements by routes\nlet mountedElements = {}\n\n// When a shared element is mounted it calls to this function\n// and we register it\nfunction register(instance, props ) {\n\tlet wrapper = props.wrapper.id\n\tif (!mountedElements[wrapper]) {\n\t\tmountedElements[wrapper] = []\n\t}\n\tmountedElements[wrapper].push(instance);\n}\n\n// When it's unmounted we delete the references to it\nfunction unregister(instance) {\n\tlet wrapper = instance.props.wrapper.id\n\tlet stack = mountedElements[ wrapper ]\n\tif( !stack ) return;\n\t\n\tif (stack) {\n\t\tlet i = stack.length\n\t\twhile (i-- > 0) {\n\t\t\tif (stack[i] === instance) {\n\t\t\t\tstack.splice(i, 1); \n\t\t\t}\n\t\t}\n\t}\n}\n\n// Layers registered callback to listen to transitions\nlet clbks = []\n\n// Here we will be store the current breakPoint and screenIndexes when\n// the shared elements are measured\nlet breakPoint, screenIndexes;\n\n// Needs to force all the shared element to measure themselves in order to get\n// the rights coords to start the shared element transitions\n// This is called by the ScreenStack when the transition has just been required\nfunction reMeasure( layout, bp, indexes ){\n\tlet screens = Object.keys( mountedElements );\n\tif( screens.length < 2 ) return;\n\n\tbreakPoint = bp\n\tscreenIndexes = indexes\n\n\tlet offset = { x: layout.x, y: layout.y };\n\tscreens.forEach( key => {\n\t\tmountedElements[key].forEach( el => {\n\t\t\tel.measure( offset );\n\t\t})\n\t})\n}\n\n// This method is called just before starting the screen transition when the URL changes\n// Screen stack is the one responsible of calling it through the context\nfunction startTransition( leavingKeys, enteringKeys, toIndex, leavingTransition ){\n\tclbks.forEach( clbk => clbk( leavingKeys, enteringKeys, toIndex, leavingTransition ) )\n}\n\nclass TransitionLayer extends Component {\n\tconstructor( props ){\n\t\tsuper( props )\n\t\tthis.state = {\n\t\t\telements: []\n\t\t}\n\t\tthis.checkForTransitions = this.checkForTransitions.bind(this);\n\t}\n\n\trender(){\n\t\tlet layout = this.props.layout;\n\t\tlet box = {\n\t\t\ttop: layout.y || 0,\n\t\t\tright: (layout.x || 0) + layout.width,\n\t\t\tleft: layout.x || 0,\n\t\t\tbottom: (layout.y || 0) + layout.height\n\t\t}\n\n\t\tlet elements = this.state.elements;\n\t\tlet list = Object.keys( elements ).map( id => elements[id] );\n\n\t\tif( list.length > 0 ){\n\t\t\tconsole.log( 'couples found, rendering', list.length )\n\t\t}\n\t\t\n\t\treturn (\n\t\t\t<View style={ [styles.container, box] } pointerEvents=\"none\">\n\t\t\t\t{ list }\n\t\t\t</View>\n\t\t)\n\t}\n\n\tcheckForTransitions(enteringKeys, leavingKeys, toIndex, leavingTransition) {\n\t\tlet couples = this.getTransitionCouples( enteringKeys, leavingKeys )\n\n\t\tif (!couples.length) return;\n\n\t\tthis.leavingTransition = leavingTransition;\n\n\t\tthis.waitForReadyAndRender( couples, toIndex );\n\t}\n\n\twaitForReadyAndRender( couples, toIndex ){\n\t\t// Check if the boxes are already calculated\n\t\tlet i = couples.length;\n\t\twhile( i-- > 0 ){\n\t\t\tif( !couples[i].leaving.box || !couples[i].entering.box ){\n\t\t\t\t// oops! retry\n\t\t\t\treturn setTimeout( () => this.waitForReadyAndRender( couples, toIndex ) );\n\t\t\t}\n\t\t}\n\t\t\n\t\tlet elements = {}\n\t\tcouples.forEach( couple => {\n\t\t\tlet id = createId()\n\t\t\t// console.log( `from ${JSON.stringify(couple.leaving.box)} to ${JSON.stringify(couple.entering.box)}` )\n\t\t\telements[ id ] = this.renderElement( couple, id )\n\t\t});\n\n\t\tthis.setState({elements})\n\t}\n\n\trenderElement( {leaving, entering}, id ){\n\t\treturn (\n\t\t\t<TransitionElement key={ id }\n\t\t\t\tleaving={ leaving }\n\t\t\t\tentering={ entering }\n\t\t\t\tbreakPoint={ breakPoint }\n\t\t\t\tscreenIndexes={ screenIndexes }\n\t\t\t\tleavingTransition={ this.leavingTransition && this.leavingTransition( breakPoint ) }\n\t\t\t\tonTransitionEnd={ () => this.removeElement(id) } />\n\t\t)\n\t}\n\n\tremoveElement( id ){\n\t\tlet elements = { ...this.state.elements }\n\t\tdelete elements[id]\n\t\tthis.setState({elements})\n\t}\n\n\tcleanProps( props ){\n\t\tlet clean = {};\n\n\t\tObject.keys( props ).forEach( p => {\n\t\t\tif( p !== 'se' && p !== 'wrapper' && p !== 'children' && p !== 'transitionStyles' ) {\n\t\t\t\tclean[ p ] = props[p]\n\t\t\t}\n\t\t});\n\n\t\treturn clean;\n\t}\n\t\n\tgetTransitionCouples( fromIds, toIds ){\n\t\tlet leaving = {};\n\t\tlet couples = [];\n\n\t\tfromIds.forEach( id => {\n\t\t\tmountedElements[id] && mountedElements[id].forEach( el => {\n\t\t\t\tleaving[ el.props.sharedId ] = el;\n\t\t\t})\n\t\t})\n\n\t\ttoIds.forEach( id => {\n\t\t\tmountedElements[id] && mountedElements[id].forEach( el => {\n\t\t\t\tif ( leaving[el.props.sharedId] ){\n\t\t\t\t\tcouples.push({\n\t\t\t\t\t\tleaving: leaving[ el.props.sharedId ],\n\t\t\t\t\t\tentering: el\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\n\t\treturn couples;\n\t}\n\n\tcomponentDidMount(){\n\t\t// Start listening to transitions\n\t\tclbks.push( this.checkForTransitions );\n\t}\n\n\tcomponentWillUnmount(){\n\t\tlet i = clbks.length;\n\t\twhile( i-- > 0 ){\n\t\t\tif( clbks[i] === this.checkForTransitions ){\n\t\t\t\t// Remove the callback\n\t\t\t\tclbks.splice( i , 1 );\n\t\t\t}\n\t\t}\n\t}\n}\n\nconst styles = StyleSheet.create({\n\tcontainer: {\n\t\tposition: 'absolute',\n\t\tzIndex: 10000\n\t}\n})\n\nconst SharedElementWrapper = props => (\n\t<Context.Provider value={{ register, unregister, startTransition, reMeasure }}>\n\t\t{ props.children }\n\t\t<TransitionLayer router={ props.router } layout={ props.layout } />\n\t</Context.Provider>\n);\n\nexport {\n\tContext,\n\tSharedElementWrapper\n}","import React, {Component} from 'react'\nimport PropTypes from 'prop-types'\nimport {Animated, View, StyleSheet, Platform} from 'react-native'\nimport {memoize, bind} from './utils/utils'\nimport ScreenWrapper from './ScreenWrapper'\nimport {animatedStyles} from './utils/animatedStyles'\nimport {Context} from './utils/sharedElementContext'\n\nconst isWeb = Platform.OS === 'web'\n\nexport default class ScreenStack extends Component {\n\tstatic propTypes = {\n\t\trouter: PropTypes.object,\n\t\tscreenTransition: PropTypes.object,\n\t\tstackTransition: PropTypes.object,\n\t\tstackIndexes: PropTypes.object,\n\t\tstack: PropTypes.array,\n\t\tindex: PropTypes.number,\n\t\tlayout: PropTypes.object\n\t}\n\n\tstatic defaultProps = {\n\t\tstackTransition: {},\n\t\tstackIndexes: {} \n\t}\n\n\tstatic contextType = Context;\n\n\tconstructor( props ){\n\t\tsuper( props );\n\t\t\n\t\tlet { stack, index } = props\n\n\t\tthis.state = {\n\t\t\tindexes: this.calculateIndexes({}, stack, index ),\n\t\t\tlayout: false\n\t\t}\n\n\t\tthis.previousIndex = index;\n\t\tthis.previousScreen = stack[index].key;\n\n\t\t// memoize a couple of methods\n\t\tthis.calculateIndexes = memoize( this.calculateIndexes.bind( this ) )\n\t\tthis.updateRelativeIndexes = memoize( this.updateRelativeIndexes.bind( this ) )\n\n\t\t// Track the screens that are ready for transitions\n\t\t// the one who have already a layout\n\t\tthis.readyScreens = {}\n\n\t\tbind( this, ['_onScreenReady', '_onScreenUnmount'] );\n\t}\n\n\trender(){\n\t\tlet { stack, router } = this.props\n\t\tlet containerStyles = [\n\t\t\tstyles.container,\n\t\t\tthis.animatedStyles\n\t\t]\n\n\t\treturn (\n\t\t\t<Animated.View style={containerStyles}>\n\t\t\t\t<View style={styles.stack} onLayout={ e => this.updateLayout(e) }>\n\t\t\t\t\t{ this.renderScreens(router, stack) }\n\t\t\t\t</View>\n\t\t\t</Animated.View>\n\t\t)\n\t}\n\t\n\trenderScreens( router, stack ){\n\t\tlet { layout, indexes } = this.state\n\t\t\n\t\t// Wait for the layout to be drawn\n\t\tif( !layout ) return;\n\n\t\tlet screens = [];\n\t\tstack.forEach( item => {\n\t\t\tlet key = item.key;\n\n\t\t\tif( !indexes[key] ) {\n\t\t\t\t// We are probably rebuilding indexes after navigating\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tscreens.push(\n\t\t\t\t<ScreenWrapper item={ item }\n\t\t\t\t\tScreenStack={ ScreenStack }\n\t\t\t\t\trouter={ router }\n\t\t\t\t\tindexes={ indexes[ key ] }\n\t\t\t\t\tlayout={ layout }\n\t\t\t\t\ttransition={ this.getScreenTransition( item.Screen ) }\n\t\t\t\t\tonReady={ this._onScreenReady }\n\t\t\t\t\tonUnmount={ this._onScreenUnmount }\n\t\t\t\t\tdrawer={ this.props.drawer }\n\t\t\t\t\tbreakPoint={ this.props.breakPoint }\n\t\t\t\t\tkey={ key }\n\t\t\t\t\tnavProps={ this.props.navProps } />\n\t\t\t)\n\t\t})\n\t\treturn screens;\n\t}\n\n\tgetScreenTransition( Screen ){\n\t\tif( typeof Screen.getTransition === 'function' ){\n\t\t\tlet transition = Screen.getTransition( this.props.breakPoint );\n\t\t\tif( transition === false ) return;\n\t\t\tif( transition ) return transition;\n\t\t}\n\n\t\treturn this.props.screenTransition;\n\t}\n\n\tupdateLayout( e ){\n\t\tthis.setState({ layout: e.nativeEvent.layout });\n\t\tthis.animatedStyles = animatedStyles(this.props.stackTransition, this.props.stackIndexes, e.nativeEvent.layout )\n\t}\n\n\tcomponentDidUpdate() {\n\t\tlet { stack, index, screenTransition } = this.props\n\t\tlet indexes = this.calculateIndexes( this.state.indexes, stack, this.previousIndex, screenTransition )\n\n\t\t// Check if the indexes has changed\n\t\tif( indexes !== this.state.indexes ){\n\t\t\tthis.setState( { indexes } );\n\t\t}\n\t\t\n\t\t// If the flag needRelativeUpdate is up, we need to update the relative\n\t\t// indexes to start the animations\n\t\tif (this.needRelativeUpdate) {\n\t\t\t\n\t\t\t// All the shared elements have been mounted, measure them ASAP\n\t\t\tthis.context.reMeasure(\n\t\t\t\tthis.props.layout,\n\t\t\t\tthis.props.breakPoint,\n\t\t\t\tthis.transitionIndexes\n\t\t\t);\n\n\t\t\t// Unset the transitionIndexes now\n\t\t\tthis.transitionIndexes = false;\n\n\t\t\t// Calculate next indexes\n\t\t\tlet nextIndexes = this.updateRelativeIndexes(indexes, stack, index);\n\n\t\t\t// At the next tick we can update the indexes and start the animations\n\t\t\tsetTimeout( () => {\n\t\t\t\tthis.needRelativeUpdate = false;\n\t\t\t\tthis.startTransition( this.state.indexes, nextIndexes );\n\t\t\t\tthis.setState({ indexes: nextIndexes })\n\t\t\t})\n\t\t}\n\n\t\t// If the pointer to the current screen has changed we need to start\n\t\t// the animations at the next tick, so raise the flag needRelativeUpdate\n\t\tif( index !== this.previousIndex || stack[index].key !== this.previousScreen ){\n\t\t\tthis.transitionIndexes = {\n\t\t\t\tleaving: this.previousIndex,\n\t\t\t\tentering: index\n\t\t\t}\n\t\t\tthis.needRelativeUpdate = true;\n\t\t\tthis.previousIndex = index;\n\t\t\tthis.previousScreen = stack[index].key;\n\t\t\tthis.forceUpdate();\n\t\t}\n\t}\n\n\t/**\n\t * Calculate new indexes based on the previous one and the stack.\n\t * If there are no changes in the indexes, returns oldIndexes.\n\t */\n\tcalculateIndexes( oldIndexes, stack, activeIndex ){\n\t\tlet count = stack.length\n\t\tlet indexes = { ...oldIndexes }\n\t\tlet unusedIndexes = { ...oldIndexes }\n\t\tlet updated = false;\n\n\t\tstack.forEach( ({ key }, i) => {\n\t\t\tif( unusedIndexes[key] ){\n\t\t\t\treturn delete unusedIndexes[key]\n\t\t\t}\n\n\t\t\tupdated = true;\n\n\t\t\tindexes[ key ] = {\n\t\t\t\tscreen: i,\n\t\t\t\tcount: count,\n\t\t\t\trelative: activeIndex - i,\n\t\t\t\ttransition: new Animated.Value( activeIndex - i ),\n\t\t\t\tparent: this.props.parentIndexes\n\t\t\t}\n\t\t})\n\n\t\t// Delete tranistions not used\n\t\tObject.keys( unusedIndexes ).forEach( key => {\n\t\t\tdelete indexes[key]\n\t\t\tupdated = true;\n\t\t})\n\n\t\treturn updated ? indexes : oldIndexes\n\t}\n\t\n\t/**\n\t * Updates the relative index and the transitions.\n\t * Needs to be called when the activeIndex changes.\n\t */\n\tupdateRelativeIndexes( oldIndexes, stack, activeIndex ){\n\t\tlet indexes =  { ...oldIndexes }\n\t\tlet count = stack.length\n\n\t\tstack.forEach( ({key}, i) => {\n\t\t\tlet index = {\n\t\t\t\tscreen: i,\n\t\t\t\tcount: count,\n\t\t\t\trelative: activeIndex - i,\n\t\t\t\ttransition: indexes[key].transition,\n\t\t\t\tparent: this.props.parentIndexes\n\t\t\t}\n\n\t\t\tindexes[key] = index;\n\t\t})\n\n\t\treturn indexes;\n\t}\n\n\tstartTransition( prevIndexes, nextIndexes ){\n\t\tlet prevItem, nextItem, toIndex;\n\n\t\t// Screen transitions\n\t\tthis.props.stack.forEach( item  => {\n\t\t\tlet { key, Screen } = item;\n\n\t\t\tlet prevIndex = prevIndexes[key];\n\t\t\tlet nextIndex = nextIndexes[key];\n\n\t\t\tif( prevIndex.relative === 0 ){\n\t\t\t\tprevItem = item;\n\t\t\t}\n\t\t\tif( nextIndex.relative === 0 ){\n\t\t\t\tnextItem = item;\n\t\t\t\ttoIndex = prevIndex.relative;\n\t\t\t}\n\n\t\t\tif( prevIndex && nextIndex && prevIndex.relative !== nextIndex.relative) {\n\t\t\t\tlet transition = this.getScreenTransition( Screen );\n\t\t\t\tAnimated.timing( nextIndex.transition, {\n\t\t\t\t\ttoValue: nextIndex.relative,\n\t\t\t\t\teasing: transition.easing,\n\t\t\t\t\tduration: transition.duration || 300,\n\t\t\t\t\tuseNativeDriver: !isWeb,\n\t\t\t\t}).start()\n\t\t\t}\n\t\t})\n\n\t\t// Signal for shared elements transition to start\n\t\tif (prevItem && nextItem) {\n\t\t\tthis.context.startTransition(\n\t\t\t\tthis.getActiveScreens(prevItem),\n\t\t\t\tthis.getActiveScreens(nextItem),\n\t\t\t\ttoIndex,\n\t\t\t\tprevItem.Screen.getTransition\n\t\t\t);\n\t\t}\n\t}\n\n\tgetActiveScreens( item ){\n\t\tlet keys = [item.key]\n\t\tlet tabs = item.tabs\n\n\t\tif( tabs ){\n\t\t\tkeys = keys.concat(\n\t\t\t\tthis.getActiveScreens( tabs.stack[tabs.activeIndex] )\n\t\t\t)\n\t\t}\n\n\t\treturn keys;\n\t}\n\n\t_onScreenReady( id ){\n\t\tthis.readyScreens[ id ] = 1;\n\t}\n\n\t_onScreenUnmount( id ){\n\t\tdelete this.readyScreens[id];\n\t}\n}\n\nlet styles = StyleSheet.create({\n\tcontainer: {\n\t\tflex: 1,\n\t\tposition: 'relative',\n\t\tzIndex: 1\n\t},\n\tdrawer: {},\n\tstack: {\n\t\theight: '100%', width: '100%'\n\t}\n})","import React, {Component} from 'react'\nimport { StyleSheet, Animated, View } from 'react-native'\nimport {animatedStyles} from './utils/animatedStyles'\n\n\nexport default class ModalWrapper extends Component {\n\tconstructor(props){\n\t\tsuper(props)\n\t\tthis.setAnimatedLayout( props.indexes, props.layout )\n\t}\n\n\trender(){\n\t\tlet containerStyles = [\n\t\t\tstyles.container,\n\t\t\tthis.animatedStyles\n\t\t]\n\n\t\tlet item = this.props.stack[0];\n\t\tlet content;\n\t\tconsole.log( this.props )\n\t\tif( item ){\n\t\t\tcontent =(\t\n\t\t\t\t<item.Screen router={ this.props.router }\n\t\t\t\t\tdrawer={ this.props.drawer }\n\t\t\t\t\tindexes={ this.props.indexes }\n\t\t\t\t\tlayout={ this.props.layout }\n\t\t\t\t\tlocation={ item.location }\n\t\t\t\t\tbreakPoint={ this.props.breakPoint }\n\t\t\t\t\t{...this.props.navProps } />\n\t\t\t)\n\t\t}\n\n\t\treturn (\n\t\t\t<Animated.View style={ containerStyles }>\n\t\t\t\t{ content }\n\t\t\t</Animated.View>\n\t\t)\n\t}\n\n\tgetScreenItem( item ){\n\t\tif( item && item !== this.item ){\n\t\t\tthis.item = item;\n\t\t}\n\t\treturn this.item;\n\t}\n\t\n\tsetAnimatedLayout( indexes, layout ){\n\t\tthis.animatedStyles = animatedStyles( this.props.transition, indexes, layout )\n\t}\n\n\tcomponentWillReceiveProps( nextProps ){\n\t\tif( this.hasLayoutChanged( nextProps ) ){\n\t\t\tthis.setAnimatedLayout( nextProps.indexes, nextProps.layout );\n\t\t}\n\t}\n\n\thasLayoutChanged( nextProps ){\n\t\tif( !nextProps.indexes ) return;\n\t\t\n\t\tlet { width } = nextProps.layout;\n\t\tlet { showing } = nextProps.indexes;\n\t\tlet { layout, indexes } = this.props;\n\n\t\treturn (\n\t\t\twidth !== layout.width ||\n\t\t\tshowing !== indexes.showing\n\t\t)\n\t}\n}\n\nlet styles = StyleSheet.create({\n\tcontainer: {\n\t\toverflow: 'hidden',\n\t\tposition: 'absolute',\n\t\twidth: '100%', height: '100%',\n\t\ttop: 0, left: 0,\n\t\tzIndex:10,\n\t\tshadowColor: '#000',\n\t\tshadowOpacity: .1,\n\t\tshadowRadius: 10,\n\t\televation: 3\n\t}\n})","import React, {Component} from 'react'\nimport { StyleSheet, Animated, View } from 'react-native'\nimport {animatedStyles} from './utils/animatedStyles'\nimport Interactable from 'react-interactable'\n\nlet handleWidth = 15\n\nexport default class DrawerWrapper extends Component {\n\tconstructor(props){\n\t\tsuper(props)\n\n\t\t// This will be true when we know the real width of the drawer\n\t\tthis.layoutUpdated = false;\n\t\tthis.drawerWidth = 300;\n\n\t\tthis.drawerPos = new Animated.Value(0);\n\t\tthis.calculateDrawerIndex();\n\t\n\t\tthis.state = {\n\t\t\topen: false\n\t\t}\n\n\t\tthis.overlayAnimStyle = {\n\t\t\ttransform: [{translateX: this.drawerIndex.interpolate({\n\t\t\t\tinputRange: [0, 0.01, 1],\n\t\t\t\toutputRange: [ -10000, 0, 0]\n\t\t\t})}],\n\t\t\topacity: this.drawerIndex.interpolate({\n\t\t\t\tinputRange: [0,0,1,1],\n\t\t\t\toutputRange: [0,0,.5,.5]\n\t\t\t})\n\t\t}\n\n\t\tconst drawerMethods = {\n\t\t\topen: () => this.openDrawer(),\n\t\t\tclose: () => this.closeDrawer()\n\t\t}\n\t\tthis._drawerMethods = drawerMethods\n\t}\n\n\trender(){\n\t\tlet { Drawer, router, collapsible, navProps } = this.props\n\t\tlet handle, overlay\n\t\tif( collapsible ){\n\t\t\thandle = <View style={ styles.handle } />\n\t\t\toverlay = (\n\t\t\t<Animated.View style={ [styles.overlay, this.overlayAnimStyle] }\n\t\t\t\tonClick={ () => this.closeDrawer() }>\n\t\t\t</Animated.View>\n\t\t\t)\n\t\t}\n\n\t\tlet width = this.state.open ? this.drawerWidth * 2 : this.drawerWidth + handleWidth;\n\t\tlet left = this.layoutUpdated ? handleWidth - this.drawerWidth : -3000;\n\n\t\tlet containerStyles = [\n\t\t\tstyles.container,\n\t\t\tcollapsible && styles.collapsibleContainer,\n\t\t\tcollapsible && {width, left},\n\t\t\tthis.animatedStyles\n\t\t]\n\n\t\tlet drawerStyles = [\n\t\t\tstyles.drawer,\n\t\t\tcollapsible && styles.collapsibleDrawer\n\t\t]\n\n\t\tlet snapPoints = [\n\t\t\t{ x: 0, id: 'closed' }, {x: this.drawerWidth - handleWidth - 10, id: 'open'}\n\t\t];\n\n\t\treturn (\n\t\t\t<Animated.View style={ containerStyles }>\n\t\t\t\t{ overlay }\n\t\t\t\t<Interactable.View dragEnabled={ !!collapsible }\n\t\t\t\t\tref=\"drawer\"\n\t\t\t\t\thorizontalOnly={ true } snapPoints={ snapPoints }\n\t\t\t\t\tboundaries={{right: this.drawerWidth - handleWidth, bounce: 0}}\n\t\t\t\t\tonDrag={ e => this.onDrag( e ) }\n\t\t\t\t\tanimatedValueX={ this.drawerPos }>\n\t\t\t\t\t<View style={ drawerStyles } ref=\"layout\" onLayout={ e => this.updateLayout(e) }>\n\t\t\t\t\t\t<Drawer router={ router }\n\t\t\t\t\t\t\tdrawer={ this._drawerMethods }\n\t\t\t\t\t\t\tlayout={ this.props.layout }\n\t\t\t\t\t\t\tbreakPoint={ this.props.breakPoint }\n\t\t\t\t\t\t\tindexes={{ transition: this.drawerIndex }}\n\t\t\t\t\t\t\t{ ...navProps } />\n\t\t\t\t\t\t{ handle }\n\t\t\t\t\t</View>\n\t\t\t\t</Interactable.View>\n\t\t\t</Animated.View>\n\t\t)\n\t}\n\t\n\tupdateLayout( e ){\n\t\tlet {layout} = e.nativeEvent;\n\n\t\tthis.layoutUpdated = true;\n\t\tthis.animatedStyles = animatedStyles(this.props.transition, this.props.indexes, layout );\n\t\tthis.drawerWidth = layout.width;\n\t\tthis.calculateDrawerIndex();\n\t\tthis.forceUpdate();\n\t}\n\n\tcomponentDidUpdate(prevProps) {\n\t\tif( prevProps.collapsible !== this.props.collapsible ){\n\t\t\tthis.drawerPos.setValue(0);\n\t\t}\n\t\tif( prevProps.breakPoint !== this.props.breakPoint ){\n\t\t\tthis.refs.layout.measure( (dx, dy, width, height, x, y) => {\n\t\t\t\tthis.updateLayout({ nativeEvent: {layout: {width, height, x, y}}});\n\t\t\t})\n\t\t}\n\t}\n\n\tcalculateDrawerIndex(){\n\t\tlet di = this.drawerIndex;\n\t\tlet index = this.drawerPos.interpolate({\n\t\t\tinputRange: [0, this.drawerWidth ],\n\t\t\toutputRange: [0, 1]\n\t\t})\n\n\t\tif( di ){\n\t\t\tdi._config = index._config;\n\t\t\tdi._interpolation = index._interpolation;\n\t\t}\n\t\telse {\n\t\t\tthis.drawerIndex = index;\n\t\t}\n\t}\n\n\topenDrawer(){\n\t\tif( !this.props.collapsible || this.state.open ) return;\n\n\t\tlet drawer = this.refs.drawer\n\t\tthis.setState({open: true})\n\t\tdrawer && drawer.setVelocity({x: 2000})\n\t}\n\n\tcloseDrawer(){\n\t\tif( !this.props.collapsible || !this.state.open ) return;\n\n\t\tlet drawer = this.refs.drawer\n\t\tthis.setState({open: false})\n\t\tdrawer && drawer.setVelocity({x: -2000})\n\t}\n\n\tonDrag( e ){\n\t\tif( e.nativeEvent ) e = e.nativeEvent\n\t\t\n\t\tif( e.state === 'start' ){\n\t\t\tthis.setState({open: true})\n\t\t}\n\t\telse if( e.state === 'end' && e.targetSnapPointId === 'closed' ){\n\t\t\tthis.setState({open: false})\n\t\t}\n\t}\n}\n\nlet styles = StyleSheet.create({\n\tcontainer: {\n\t\tflexDirection: 'row'\n\t},\n\tcollapsibleContainer: {\n    position: 'absolute',\n\t\ttop: 0, bottom: 0,\n\t\tzIndex: 2000,\n\t},\n\tdrawer: {\n    // position: 'absolute',\n\t\ttop: 0, left: 0,\n\t\theight: '100%', width: '100%',\n\t\tflex: 1\n\t},\n\tcollapsibleDrawer: {\n    left: 0,\n    width: '100%',\n    flex: 1,\n\t\tposition: 'relative',\n\t\tzIndex: 20000,\n\t\tpaddingRight: handleWidth\n\t},\n\thandle: {\n\t\twidth: handleWidth,\n\t\ttop: 0, bottom: 0, right: 0,\n\t\t// backgroundColor: 'green',\n\t\tposition: 'absolute',\n\t\tzIndex: 10\n\t},\n\toverlay: {\n\t\tbackgroundColor: 'black',\n\t\theight: '100%',\n\t\twidth: '400%',\n\t\tposition: 'absolute'\n\t},\n\texpander: {\n\t\tposition: 'absolute',\n\t\theight: '100%',\n\t\ttop: 0, left: 0, bottom: 0\n\t}\n})","import { Easing } from 'react-native'\n\nexport default {\n\tstyles: function desktopMobileTransition( indexes, layout ){\n\t\tlet leftColumn = indexes.screen ? 400 : 0;\n\t\treturn {\n\t\t\twidth: {\n\t\t\t\tinputRange: [ -2, -1, 0, 1, 2, 3 ],\n\t\t\t\toutputRange: [ 0, 0, layout.width - leftColumn, 400, 0, 0]\n\t\t\t},\n\t\t\t\n\t\t\ttranslateX: {\n\t\t\t\tinputRange: [ -2, -1, 0, 1, 2 ],\n\t\t\t\toutputRange: [ layout.width, layout.width, leftColumn, 0, 0]\n\t\t\t}\n\t\t}\n\t},\n\teasing: Easing.linear,\n\tduration: 300,\n\n\t// different transitions for modals can be set here\n\t// modalTransition: { stack, drawer, modal}\n}","export default {\n\tstyles: function mobileDefaultTransition( indexes, layout ){\n\t\treturn {\n\t\t\ttranslateX: {\n\t\t\t\tinputRange: [ -2, -1, 0, 1 ],\n\t\t\t\toutputRange: [ layout.width, layout.width, 0, 0 ]\n\t\t\t},\n\t\t\topacity: {\n\t\t\t\tinputRange: [ -2, -1, 0, .8, 1 ],\n\t\t\t\toutputRange: [ 0, 1, 1, 0, 0]\n\t\t\t},\n\t\t\tscale: {\n\t\t\t\tinputRange: [ -1, 0, 1, 2 ],\n\t\t\t\toutputRange: [ 1, 1, .5, .5]\n\t\t\t}\n\t\t}\n\t},\n\tduration: 300,\n\tcollapsibleDrawer: true,\n\t\n\t// different transitions for modals can be set here\n\t// modalTransition: { stack, drawer, modal}\n\n\t// also transitions for tabs\n\t// tabTransition: {styles, duration, easing}\n}","import {Easing} from 'react-native'\n\nlet stackAndDrawer = {\n\tstyles: {\n\t\ttranslateY: {\n\t\t\tinputRange: [ 0, 1 ],\n\t\t\toutputRange: [ -100, 0 ]\n\t\t},\n\t\topacity: {\n\t\t\tinputRange: [ 0, 1 ],\n\t\t\toutputRange: [ 0, 1 ]\n\t\t}\n\t},\n\teasing: Easing.linear,\n\tduration: 300\n}\n\nexport default {\n\tstack: stackAndDrawer,\n\tdrawer: stackAndDrawer,\n\tmodal:{\n\t\tstyles: function modalDefaultTransition( indexes, layout ) {\n\t\t\treturn {\n\t\t\t\ttranslateY: {\n\t\t\t\t\tinputRange: [ 0, 1 ],\n\t\t\t\t\toutputRange: [ layout.height, 0 ]\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\teasing: Easing.linear,\n\t\tduration: 300\n\t}\n}","import React, {Component} from 'react'\nimport PropTypes from 'prop-types'\nimport createRouter from 'urlstack'\nimport { Dimensions, View, StyleSheet, Animated, Platform, StatusBar, BackHandler } from 'react-native'\nimport ScreenStack from './ScreenStack'\nimport ModalWrapper from './ModalWrapper'\nimport DrawerWrapper from './DrawerWrapper'\nimport { SharedElementWrapper } from './utils/sharedElementContext'\nimport desktopTransition from './defaultTransitions/desktopTransition'\nimport mobileTransition from './defaultTransitions/mobileTransition'\nimport modalTransition from './defaultTransitions/modalTransition'\nimport {memoize} from './utils/utils'\n\nconst isWeb = Platform.OS === 'web'\n\nlet router = createRouter();\nexport {router};\n\nexport default class Navigator extends Component {\n\tconstructor( props ){\n\t\tsuper( props )\n\n\t\tthis.state = {\n\t\t\tlayout: this.getWindowSize()\n\t\t};\n\n\t\tthis.calculateTransition( props.transitions, this.state.layout.width )\n\n\t\tthis.getScreenStack = memoize( this.getScreenStack )\n\t\tthis._onBack = this._onBack.bind( this )\n\n\t\tthis.drawer = {\n\t\t\topen: () => this.drawerInstance.openDrawer(),\n\t\t\tclose: () => this.drawerInstance.closeDrawer(),\n\t\t}\n\n\t\tBackHandler.addEventListener( 'hardwareBackPress', this._onBack )\n\t}\n\n\tstatic propTypes = {\n\t\ttransitions: PropTypes.object,\n\t\tinterceptor: PropTypes.func\n\t}\n\n\tstatic defaultProps = {\n\t\ttransitions: {\n\t\t\t0: mobileTransition,\n\t\t\t800: desktopTransition\n\t\t}\n\t}\n\n\trender(){\n\t\tlet router = this.router;\n\t\tif( !router ) return null;\n\t\t\n\t\tlet { DrawerComponent, interceptor, routes, transitions, ...props } = this.props\n\t\tlet { layout, indexes } = this.state\n\t\t\n\t\tlet transition = this.currentTransition\n\t\tlet breakPoint = this.currentBreakpoint\n\t\tlet modalTransition = this.getModalTransitions( transition )\n\t\tlet { stack, index } = this.getScreenStack( router.stack, router.activeIndex )\n\n\t\treturn (\n\t\t\t<SharedElementWrapper router={router} layout={layout}>\n\t\t\t\t<View style={ styles.windowWrapper }>\n\t\t\t\t\t<View style={styles.container} onLayout={ e => this._onLayout( e.nativeEvent.layout ) }>\n\t\t\t\t\t\t<DrawerWrapper ref={ component => this.drawerInstance = component }\n\t\t\t\t\t\t\trouter={router}\n\t\t\t\t\t\t\ttransition={modalTransition.drawer}\n\t\t\t\t\t\t\tbreakPoint={ breakPoint }\n\t\t\t\t\t\t\tindexes={indexes.stack}\n\t\t\t\t\t\t\tcollapsible={ transition.collapsibleDrawer }\n\t\t\t\t\t\t\tDrawer={ DrawerComponent }\n\t\t\t\t\t\t\tnavProps={ props } />\n\t\t\t\t\t\t<ScreenStack router={router}\n\t\t\t\t\t\t\tscreenTransition={transition}\n\t\t\t\t\t\t\tstackTransition={modalTransition.stack}\n\t\t\t\t\t\t\tstackIndexes={indexes.stack}\n\t\t\t\t\t\t\tbreakPoint={ breakPoint }\n\t\t\t\t\t\t\tstack={stack}\n\t\t\t\t\t\t\tindex={index}\n\t\t\t\t\t\t\tlayout={layout}\n\t\t\t\t\t\t\tdrawer={this.drawer}\n\t\t\t\t\t\t\tnavProps={props}/>\n\t\t\t\t\t\t<ModalWrapper router={router}\n\t\t\t\t\t\t\tstack={router.modal.stack}\n\t\t\t\t\t\t\tindex={router.modal.stack}\n\t\t\t\t\t\t\ttransition={modalTransition.modal}\n\t\t\t\t\t\t\tbreakPoint={ breakPoint }\n\t\t\t\t\t\t\tindexes={indexes.modal}\n\t\t\t\t\t\t\tlayout={layout}\n\t\t\t\t\t\t\tdrawer={this.drawer}\n\t\t\t\t\t\t\tnavProps={props} />\n\t\t\t\t\t</View>\n\t\t\t\t</View>\n\t\t\t</SharedElementWrapper>\n\t\t)\n\t}\n\n\tcalculateTransition( transitions, width ){\n\t\tlet breakPoints = Object.keys( transitions ).sort( (a,b) => a - b )\n\t\tlet i = breakPoints.length\n\t\t\n\t\twhile( i-- > 0 ){\n\t\t\tif( width >= parseInt( breakPoints[i]) ){\n\t\t\t\tthis.currentTransition = transitions[ breakPoints[i] ]\n\t\t\t\tthis.currentBreakpoint = parseInt(breakPoints[i]);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t\n\t\tthis.currentTransition = transitions[ breakPoints[0] ]\n\t\tthis.currentBreakpoint = parseInt(breakPoints[0]);\n\t}\n\n\tgetModalTransitions( transition ){\n\t\tlet t = transition || this.currentTransition;\n\t\treturn t.modalTransition || modalTransition\n\t}\n\n\t// Takes the modal screens out of the stack\n\tgetScreenStack( routerStack, routerIndex ){\n\t\tlet stack = routerStack.slice();\n\t\tlet index = routerIndex;\n\t\tlet lastIndex = routerStack.length - 1;\n\t\tlet last = stack[ lastIndex ]\n\t\tlet options = last.Screen.urlstackOptions || {}\n\n\t\tif( options.modal ){\n\t\t\tstack.pop()\n\t\t\tif( index === lastIndex ){\n\t\t\t\tindex--;\n\t\t\t}\n\t\t}\n\n\t\treturn {stack, index}\n\t}\n\n\tstartRouter(){\n\t\trouter.setRoutes( this.props.routes );\n\n\t\tlet interceptor = this.props.interceptor;\n\t\tif( interceptor ){\n\t\t\trouter.onBeforeChange( interceptor );\n\t\t}\n\n\t\tthis.fu = () => this.forceUpdate();\n\t\trouter.onChange( () => this.fu() );\n\t\trouter.start();\n\n\t\tthis.router = router;\n\n\t\tthis.showingModal = this.detectModal();\n\t\tthis.updateModalIndexes( this.showingModal );\n\t}\n\n\tgetWindowSize(){\n\t\tlet { width, height } = Dimensions.get('window')\n\t\treturn { \n\t\t\twidth, height, x: 0, y: 0\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.startRouter();\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.fu = () => {}\n\t\tBackHandler.removeEventListener( 'hardwareBackPress', this._onBack )\n\t}\n\n\tcomponentDidUpdate( prevProps ){\n\t\tlet showModal = this.detectModal()\n\t\tif( this.showingModal !== showModal ){\n\t\t\tthis.showingModal = showModal;\n\t\t\tthis.updateModalIndexes( showModal );\n\t\t}\n\n\t\tif( prevProps.transistions !== this.props.transistions ){\n\t\t\tthis.calculateTransition( this.props.transitions, this.state.layout.width )\n\t\t}\n\t}\n\n\t_onLayout( layout ){\n\t\tconsole.log( layout )\n\t\tthis.calculateTransition( this.props.transitions, layout.width )\n\t\tthis.setState( {layout} )\n\t}\n\n\t_onBack(){\n\t\tlet router = this.router;\n\t\tlet stack = router.stack;\n\t\tlet nextRoute;\n\t\tif( router.modal.active ){\n\t\t\tif( router.modal.activeIndex ){\n\t\t\t\tnextRoute = router.modal.stack[ router.modal.activeIndex - 1 ].path\n\t\t\t}\n\t\t\telse {\n\t\t\t\tnextRoute = stack[ router.activeIndex ].location\n\t\t\t\tnextRoute = nextRoute.pathname + nextRoute.search\n\t\t\t}\n\t\t}\n\t\telse if( router.activeIndex ){\n\t\t\tnextRoute = stack[ router.activeIndex - 1 ].path\n\t\t}\n\n\t\tif( nextRoute ){\n\t\t\trouter.navigate( nextRoute )\n\t\t\treturn true; // Prevents getting out of the app\n\t\t}\n\t}\n\n\tdetectModal(){\n\t\treturn this.router.modal.active;\n\t}\n\n\tupdateModalIndexes( showModal ){\n\t\tlet {indexes} = this.state\n\n\t\tif( !indexes ){\n\t\t\tindexes = {\n\t\t\t\tmodal: {showing: !!showModal, transition: new Animated.Value( showModal ? 1 : 0) },\n\t\t\t\tstack: {showing: !showModal, transition: new Animated.Value( showModal ? 0 : 1) }\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tlet transitions = this.getModalTransitions()\n\n\t\t\tindexes = {\n\t\t\t\tmodal: {showing: !!showModal, transition: indexes.modal.transition },\n\t\t\t\tstack: {showing: !showModal, transition: indexes.stack.transition }\n\t\t\t}\n\n\t\t\tAnimated.timing( indexes.modal.transition, {\n\t\t\t\ttoValue: showModal ? 1 : 0,\n\t\t\t\teasing: transitions.modal.easing,\n\t\t\t\tduration: transitions.modal.duration || 300,\n\t\t\t\tuseNativeDriver: !isWeb\n\t\t\t}).start()\n\n\t\t\tAnimated.timing( indexes.stack.transition, {\n\t\t\t\ttoValue: showModal ? 0 : 1,\n\t\t\t\teasing: transitions.stack.easing,\n\t\t\t\tduration: transitions.stack.duration || 300,\n\t\t\t\tuseNativeDriver: !isWeb\n\t\t\t}).start()\n\t\t}\n\n\t\tthis.setState({indexes})\n\t}\n}\n\nlet statusBarHeight = Platform.OS === 'android' ? StatusBar.currentHeight : 0\n\nlet styles = StyleSheet.create({\n\twindowWrapper: {\n\t\tpaddingTop: statusBarHeight,\n\t\tflex: 1,\n\t},\n\n\tcontainer: {\n\t\tflex: 1,\n\t\tflexDirection: 'row',\n\t\toverflow: 'hidden'\n\t},\n})","import React, { Component } from 'react';\nimport { View, Platform } from 'react-native';\nimport { Context } from './utils/sharedElementContext';\nimport WrapperContext from './utils/wrapperContext';\nimport PropTypes from 'prop-types'\n\nconst isWeb = Platform.OS === 'web';\n\nclass SharedElement extends Component {\n\tstatic propTypes = {\n\t\t// These properties are used by the TransitionElement\n\t\ttransition: PropTypes.oneOf([ PropTypes.object, PropTypes.func ]),\n\t\ttransitionRender: PropTypes.func,\n\t\ttransitionState: PropTypes.number,\n\n\t\t// This sharedId is used by the sharedElementContext to match what components\n\t\t// need to be shared\n\t\tsharedId: PropTypes.string,\n\t}\n\n\tstatic defaultTypes = {\n\t\n\t}\n\t\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tprops.se.register( this, props );\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<View style={ this.props.style }\n\t\t\t\tref=\"el\"\n\t\t\t\tonLayout={ () => this._onLayout() }\n\t\t\t\tpointerEvents=\"auto\">\n\t\t\t\t{ this.props.children }\n\t\t\t</View>\n\t\t);\n\t}\n\t\n\tcomponentWillUnmount(){\n\t\tthis.props.se.unregister( this );\n\t}\n\n\tmeasure( offset ){\n\t\tthis.box = false;\n\n\t\tif( !isWeb && !this.layouted ){\n\t\t\t// We need the layout to calculate the measures properly in native\n\t\t\tconsole.log('skipping')\n\t\t\treturn setTimeout( () => this.measure( offset ) );\n\t\t}\n\t\t\n\t\tthis.refs.el && this.refs.el.measure( ( cx, cy, width, height, x, y ) => {\n\t\t\tthis.box = {\n\t\t\t\twidth, height,\n\t\t\t\tx: x - offset.x,\n\t\t\t\ty: y - offset.y\n\t\t\t};\n\t\t\t\n\t\t\tconsole.log('measured' );\n\t\t})\n\t}\n\n\t_onLayout(){\n\t\tthis.layouted = true;\n\t}\n}\n\nfunction ContextConsumerHOC( Component ){\n\treturn function SharedElementHOC( props ){\n\t\t\n\t\treturn (\n\t\t\t<Context.Consumer>\n\t\t\t\t{ se => (\n\t\t\t\t\t<WrapperContext.Consumer>\n\t\t\t\t\t\t{ wrapper => (\n\t\t\t\t\t\t\t<Component {...props} se={se} wrapper={wrapper} />\n\t\t\t\t\t\t)}\n\t\t\t\t\t</WrapperContext.Consumer>\n\t\t\t\t)}\n\t\t\t</Context.Consumer>\n\t\t)\n\t}\n}\n\nconst SharedElementWithContext = ContextConsumerHOC( SharedElement )\nexport default SharedElementWithContext\n"],"names":["memoize","fn","args","value","recalculate","fnArgs","apply","length","arguments","i","createId","Math","round","random","toString","nofn","bind","that","methods","forEach","m","styles","indexes","layout","scroll","width","translateX","inputRange","outputRange","opacity","easing","Easing","linear","duration","animatedStyles","transition","transformStyles","count","zIndex","abs","relative","Object","keys","key","styleKeys","warnKeys","console","warn","interpolate","transformKeys","type","warned","_typeof","push","transform","n","s","perspective","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","translateY","skeyX","skewY","stagger","animatedValue","gap","times","follower","Animated","Value","_value","timing","toValue","start","stagged","stage","attr","val","shifted","inputValue","animated","Context","React","createContext","ScreenWrapper","props","id","setAnimatedLayout","Component","item","this","containerStyles","container","contextValue","View","style","onLayout","_this2","onReady","Provider","renderScreen","ScreenStack","router","drawer","breakPoint","navProps","Screen","location","isTabs","screenTransition","tabTransition","stack","tabs","index","activeIndex","parentIndexes","nextProps","hasLayoutChanged","screen","onUnmount","StyleSheet","create","overflow","position","top","left","bottom","right","isWeb","Platform","OS","defaultDuration","TransitionElement","_this","getIndexes","leaving","getTransition","transitionStyles","pointerEvents","renderChildren","customRenderer","transitionRender","entering","children","transitionStyle","defaultTransition","getDefaultTransition","undefined","defaultStyles","transitionState","screenIndexes","leavingBox","box","enteringBox","leavingTransition","getInterpolation","height","x","y","fromIndex","toIndex","fromValue","inverted","log","onTransitionEnd","PropTypes","object","number","mountedElements","register","instance","wrapper","unregister","splice","clbks","reMeasure","bp","screens","offset","el","measure","startTransition","leavingKeys","enteringKeys","clbk","TransitionLayer","state","elements","checkForTransitions","list","map","couples","getTransitionCouples","waitForReadyAndRender","setTimeout","couple","renderElement","setState","_this3","removeElement","clean","p","fromIds","toIds","sharedId","SharedElementWrapper","calculateIndexes","previousIndex","previousScreen","updateRelativeIndexes","readyScreens","e","updateLayout","renderScreens","getScreenTransition","_onScreenReady","_onScreenUnmount","nativeEvent","stackTransition","stackIndexes","needRelativeUpdate","context","transitionIndexes","nextIndexes","_this4","forceUpdate","oldIndexes","unusedIndexes","updated","parent","_this5","_this6","prevIndexes","prevItem","nextItem","prevIndex","nextIndex","_this7","useNativeDriver","getActiveScreens","concat","array","flex","ModalWrapper","content","showing","shadowColor","shadowOpacity","shadowRadius","elevation","handleWidth","DrawerWrapper","layoutUpdated","drawerWidth","drawerPos","calculateDrawerIndex","open","overlayAnimStyle","drawerIndex","drawerMethods","openDrawer","close","closeDrawer","_drawerMethods","handle","overlay","Drawer","collapsible","onClick","collapsibleContainer","drawerStyles","collapsibleDrawer","snapPoints","Interactable","dragEnabled","ref","horizontalOnly","boundaries","bounce","onDrag","animatedValueX","prevProps","setValue","refs","dx","dy","di","_config","_interpolation","setVelocity","targetSnapPointId","flexDirection","paddingRight","backgroundColor","expander","leftColumn","stackAndDrawer","modal","createRouter","Navigator","getWindowSize","calculateTransition","transitions","getScreenStack","_onBack","drawerInstance","BackHandler","addEventListener","DrawerComponent","interceptor","routes","currentTransition","currentBreakpoint","modalTransition","getModalTransitions","windowWrapper","_onLayout","component","breakPoints","sort","a","b","parseInt","routerStack","routerIndex","slice","lastIndex","urlstackOptions","pop","setRoutes","onBeforeChange","fu","onChange","showingModal","detectModal","updateModalIndexes","Dimensions","get","startRouter","removeEventListener","showModal","transistions","nextRoute","active","path","pathname","search","navigate","func","mobileTransition","desktopTransition","statusBarHeight","StatusBar","currentHeight","paddingTop","SharedElement","se","layouted","cx","cy","ContextConsumerHOC","Consumer","WrapperContext","oneOf","string","SharedElementWithContext"],"mappings":"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"}