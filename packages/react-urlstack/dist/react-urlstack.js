/*!
 * react-urlstack v1.0.0
 * (c) Javier Marquez
 * Released under the MIT License.
 */
"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var parseUrl,React=require("react"),React__default=_interopDefault(React),PropTypes=_interopDefault(require("prop-types")),pathToRegexp=_interopDefault(require("path-to-regexp")),miniQuerystring=_interopDefault(require("mini-querystring")),reactNative=require("react-native"),Interactable=_interopDefault(require("react-interactable"));function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}"undefined"!=typeof window&&(parseUrl=function(e){var t=document.createElement("a");return t.href=e,t});var urlhub={create:function(e){return new Urlhub(e)},joinUrls:joinUrls},Urlhub=function(e){if(!e||!e.strategy)throw new Error("Router needs an strategy to listen to url changes.");var t=e.strategy,n={};Object.keys(e).forEach(function(t){"strategy"!==t&&(n[t]=e[t])}),t.init&&t.init(n),this.strategy=t,this.obc=[],this.cbs=[]},prototype={setRoutes:function(e){this.routes=this.parseRoutes(e)},parseRoutes:function(e,t){e||console.warn("No routes provided to parseRoutes"),e.length||(e=[e]);var n=[],a=this;return e.forEach(function(e){var r=joinUrls(t,e.path),i=[],o={regex:pathToRegexp(r,i),id:r,cb:e.cb};o.params=i.map(function(e){return e.name}),e.children&&e.children.length&&(o.childRegex=pathToRegexp(r,[],{end:!1}),o.children=a.parseRoutes(e.children,r)),n.push(o)}),n},match:function(e,t,n){var a,r,i,o,s=0,c=sanitizeUrl(e);t||(t=this.routes);var u=(this.strategy.parseUrl||parseUrl)(c);for("/"!==(a=u.pathname)[0]&&(a="/"+a);s<t.length&&!r;){if((o=t[s]).childRegex&&(r=o.childRegex.exec(a))){if(i=this.match(c,o.children,!0),i.matches.length)return i.matches=[o.cb].concat(i.matches),i.matchIds=[o.id].concat(i.matchIds),i;r=!1}(r=o.regex.exec(a))&&(r={id:o.id,cb:o.cb,params:r.slice(1)}),r||s++}var l=[],h=[];return r?(l.push(r.cb),h.push(r.id)):n||console.error("There is no route match for "+e),i={matches:l,matchIds:h,pathname:a,search:u.search,query:miniQuerystring.parse(u.search),hash:u.hash,route:r&&r.id||!1,params:{}},r&&o.params.forEach(function(e,t){i.params[e]=r.params[t]}),i},start:function(){var e=this;return this.strategy.onChange(function(){var t=e.checkChange();t.next&&(t.current!==t.next?e.strategy.replace(t.next):(e.location=t.nextLocation,e.cbs.forEach(function(e){e(t.nextLocation)})))}),this.strategy.start(),this.location=this.match(this.strategy.getLocation()),this.location},stop:function(){this.strategy.onChange(function(){})},refresh:function(){var e=this.checkChange();e.next&&e.current!==e.next&&this.strategy.replace(e.next)},checkChange:function(){var e=this.strategy.getLocation(),t=this.runOnBeforeChange(this.match(e));return{current:e,next:t&&t.pathname+t.search+t.hash,nextLocation:t}},runOnBeforeChange:function(e){var t=this;return this.obc.forEach(function(n){e&&"string"==typeof(e=n(e))&&(e=t.match(e))}),e},onBeforeChange:function(e){this.obc.push(e)},onChange:function(e){this.cbs.push(e)},push:function(e){this.updateLocation("push",e)},replace:function(e){this.updateLocation("replace",e)},back:function(){this.strategy.back()},updateLocation:function(e,t){var n,a=this.strategy.getLocation();n="string"==typeof t?t:mergeLocations(this.match(a),t);var r=this.runOnBeforeChange(this.match(n));r&&a!==(n=r.pathname+r.search+r.hash)&&this.strategy[e](n)}};for(var method in prototype)Urlhub.prototype[method]=prototype[method];var urlhub_1=urlhub;function joinUrls(e,t){var n=sanitizeUrl(e),a=sanitizeUrl(t);return e?t?"/"===n?a:"/"===a?n:n+a:n:a}function sanitizeUrl(e){if(!e)return"/";var t=e;return"/"===t[t.length-1]&&(t=t.slice(0,t.length-1)),"/"!==t[0]&&(t="/"+t),t}function mergeLocations(e,t){var n=Object.assign(e,t),a=n.search;return a=Object.keys(n.query).length?"?"+miniQuerystring.stringify(n.query):"",n.pathname+a+n.hash}var _onChange=function(){},nodeStrategy={init:function(e){this.history=[e.initialLocation||"/"]},start:function(){this.emit()},push:function(e){this.history.push(e),this.emit()},replace:function(e){this.history[this.history.length]=e,this.emit()},onChange:function(e){_onChange=e},getLocation:function(){return this.history[this.history.length-1]},emit:function(){_onChange&&_onChange(this.getLocation())},parseUrl:function(e){var t=e.split("?"),n=t[1]?t[1].split("#"):[];return{pathname:t[0],search:n[0]?"?"+n[0]:"",hash:n[1]?"#"+n[1]:"",query:n[0]?miniQuerystring.parse(n[0]):{}}},back:function(){this.history.length>1&&this.history.pop(),this.emit()}},nodeStrategy_1=nodeStrategy,_onChange$1=function(){},hashStrategy={init:function(e){},start:function(){var e=this;location.hash||(location.hash="#/"),window.onhashchange=function(){e.emit()},e.emit()},push:function(e){window.location.hash="#"+e},replace:function(e){var t=location.protocol+"//"+location.host+location.pathname+"#"+e;location.replace(t)},onChange:function(e){_onChange$1=e},getLocation:function(){return location.hash?"/"!==location.hash[1]?"/"+location.hash:location.hash.slice(1):"/"},emit:function(){_onChange$1(this.getLocation())},back:function(){window.history.back()}},hashStrategy_1=hashStrategy,_onChange$2=function(){},pushStrategy={init:function(e){this.basePath=e.basePath||"","/"===this.basePath.slice(-1)&&(this.basePath=this.basePath.slice(0,-1))},start:function(){var e=this;window.onpopstate=function(){e.emit()},e.emit()},push:function(e){history.pushState({},"",this.basePath+e),this.emit()},replace:function(e){history.replaceState({},"",this.basePath+e),this.emit()},onChange:function(e){_onChange$2=e},getLocation:function(){var e=location.pathname+location.search+location.hash,t=this.basePath.length;return e.slice(0,t)===this.basePath&&(e=e.slice(t)),e},emit:function(){_onChange$2&&_onChange$2(this.getLocation())},back:function(){window.history.back()}},pushStrategy_1=pushStrategy;function create(e,t){var n;n="undefined"==typeof document?nodeStrategy_1:t&&"hash"===t.strategy?hashStrategy_1:pushStrategy_1;var a=urlhub_1.create({strategy:n}),r=[],i={urlhub:a,stack:[],activeIndex:-1,_nestedStack:[],_lastNavigated:[],modal:{active:!1,stack:[],activeIndex:-1},onChange:function(e){r.push(e)},navigate:function(e){e===this._lastNavigated[this._lastNavigated.length-2]?(this._lastNavigated.pop(),a.push.apply(a,arguments)):(this._lastNavigated.push(e),a.push.apply(a,arguments))}};return a.setRoutes(e),a.onChange(createRouteChanger(i,e,r)),["start","stop","onBeforeChange","replace"].forEach(function(e){i[e]=function(){return this.urlhub[e].apply(this.urlhub,arguments)}}),i}function createRouteChanger(e,t,n){var a=getRouteData(t);return function(t){t.pathname+t.search+t.hash!==e._lastNavigated[e._lastNavigated.length-1]&&(e._lastNavigated=[]);var r=createNestedStack(t,a),i=mergeStacks(e._nestedStack||[],r,a),o=i.stack,s=i.index;setStacksAndIndexes(e,splitStack(o),s,a),e.location=t,e._nestedStack=o,n.forEach(function(e){return e(t)})}}function createNestedStack(e,t){var n=e.matchIds,a=!1,r=[];return n.forEach(function(n){var i=t[n];if(a)return a.tabs.activeIndex=findTab(n,a.tabs.stack),void(a=!1);var o=createStackItem(n,e,i);o.isTabs&&(o.tabs={activeIndex:0,stack:t[o.route].children.map(function(a){return createStackItem(n+a.path,e,t[n+a.path])})},a=o),r.push(o)}),a&&(a.tabs.stack.length||console.warn("Urlstack: Hit a tabs URL without any children: "+tabScreen.path)),r}function splitStack(e){var t=[],n=[];return e.forEach(function(e){e.isModal?(t.push(n),n=[e]):n.push(e)}),n.length&&t.push(n),t}function setStacksAndIndexes(e,t,n,a){if(t[0].length)e.stack=t[0],e.activeIndex=Math.max(0,Math.min(n,t[0].length-1)),e.modal&&(e.modal.active=!1);else if(!e.stack.length){var r=a[t[1][0].route].backgroundRoute||"/*",i=mergeStacks([],createNestedStack(e.urlhub.match(r),a),a),o=i.stack,s=i.index;e.stack=o,e.activeIndex=s}t.length>1&&(e.modal||(e.modal={stack:[],activeIndex:0}),e.modal.active=n>=0,setStacksAndIndexes(e.modal,t.slice(1),n-t[0].length,a))}function createStackItem(e,t,n){return{Screen:n.cb,route:e,isTabs:!!n.isTabs,isModal:!!n.isModal,location:t,path:getRoutePath(e,t.pathname),key:generateKey()}}function getRoutePath(e,t){var n=e.split("/"),a=t.split("/"),r=[];return n.forEach(function(e,t){r.push(a[t]||e)}),r.join("/")}function mergeStacks(e,t,n){for(var a=[],r=0,i=!0,o=e[0],s=t[0];o||s;)i&&o&&s?o.Screen===s.Screen?(a.push(mergeItems(o,s,n)),o.path!==s.path&&(i=!1)):(i=!1,a.push(s)):i&&o?a.push(o):s&&a.push(s),o=e[++r],s=t[r];return{stack:a,index:t.length-1}}function mergeItems(e,t,n){var a=Object.assign({},t,{key:e.key});if(a.tabs){var r=[],i=a.tabs.activeIndex;e.tabs.stack.forEach(function(e,n){r.push(n===i?t.tabs.stack[n]:e),r[n].key=e.key,r[n].visited=e.visited||n===i}),a.tabs={stack:r,activeIndex:i}}return a}function getRouteData(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n={};return e.forEach(function(e){var a=t+e.path;if(n[a]=e,e.children){var r=getRouteData(e.children,a);n=Object.assign({},n,r)}}),n}function generateKey(){return"j"+Math.floor(1e5*Math.random()).toString(36)}function findTab(e,t){for(var n=t.length;n--;)if(t[n].route===e)return n;return 0}function memoize(e){var t,n;function a(a){return t=a,n=e.apply(null,a)}return function(){if(!t||t.length!==arguments.length)return a(arguments);for(var e=0;e<t.length;){if(t[e]!==arguments[e])return a(arguments);e++}return n}}function createId(){return Math.round(1e7*Math.random()).toString(36)}function nofn(){}function bind(e,t){t.forEach(function(t){e[t]=e[t].bind(e)})}var tabTransition={styles:function(e,t){var n=t.width/2;return{translateX:{inputRange:[-2,-1,0,1,2],outputRange:[n,n,0,-n,-n]},opacity:{inputRange:[-2,-1,0,.8,1],outputRange:[0,0,1,0,0]}}},easing:reactNative.Easing.linear,duration:300};function animatedStyles(e,t,n){var a="function"==typeof e.styles?e.styles(t,n):e.styles;a||(a={});var r={},i=[];return t.count&&(r.zIndex=t.count-Math.abs(t.relative)),Object.keys(a).forEach(function(e){var n=a[e];if(styleKeys[e])warnKeys[e]&&console.warn("react-urlstack: It's possible in web, but react-native won't animate the property \"".concat(e,'"')),n&&n.inputRange?r[e]=t.transition.interpolate(n):r[e]=n;else if(transformKeys[e]){var o=transformKeys[e],s=!1;n&&n.outputRange?(a[e].outputRange.forEach(function(t){s||_typeof(t)===o||(s=!0,console.warn('react-urlstack: Even if it works in web, react-native only accepts type "'.concat(transformKeys[e],'" for "').concat(e,'". Given "').concat(t,'".')))}),i.push(_defineProperty({},e,t.transition.interpolate(n)))):i.push(_defineProperty({},e,n))}else console.warn('react-urlstack: Unknown property to animate "'.concat(e,'"'))}),i.length&&(r.transform=i),r}var styleKeys={},warnKeys={};["left","right","top","bottom"].forEach(function(e){styleKeys[e]=1,warnKeys[e]=1}),["width","height","opacity","backgroundColor","borderRadius"].forEach(function(e){styleKeys[e]=1});var n="number",s="string",transformKeys={perspective:n,rotate:s,rotateX:s,rotateY:s,rotateZ:s,scale:n,scaleX:n,scaleY:n,translateX:n,translateY:n,skeyX:s,skewY:s};function stagger(e,t,n,a){var r=new reactNative.Animated.Value(e._value);reactNative.Animated.timing(r,{duration:0,toValue:e}).start();for(var i=[animatedStyles({styles:a},{transition:r})],o=function(e){var n={};Object.keys(a).forEach(function(r){var i=a[r];if(i&&i.inputRange){var o={inputRange:[],outputRange:i.outputRange};i.inputRange.forEach(function(n){o.inputRange.push(n+e*t)}),n[r]=o}else n[r]=i});var o=animatedStyles({styles:n},{transition:r});i.push(o)},s=1;s<n;s++)o(s);return i}var Context=React__default.createContext(),ScreenWrapper=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).id=createId(),n.setAnimatedLayout(e.indexes,e.layout),n}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this,t=this.props.item,n=[styles.container,this.animatedStyles],a={transition:this.props.transition,indexes:this.props.indexes,id:t.key};return React__default.createElement(reactNative.Animated.View,{style:n,onLayout:function(){return e.props.onReady(t.key)}},React__default.createElement(Context.Provider,{value:a},this.renderScreen()))}},{key:"renderScreen",value:function(){var e=this.props,t=e.item,n=e.ScreenStack,a=e.router,r=e.transition,i=e.indexes,o=e.layout,s=e.drawer,c=e.breakPoint,u=t.Screen,l=t.location;return t.isTabs?React__default.createElement(u,{router:a,location:l,indexes:i,layout:o,drawer:s,breakPoint:c},React__default.createElement(n,{router:a,isTabs:!0,screenTransition:r.tabTransition||tabTransition,stack:t.tabs.stack,index:t.tabs.activeIndex,parentIndexes:i,layout:o,breakPoint:c})):React__default.createElement(u,{router:a,location:l,indexes:i,layout:o,drawer:s,breakPoint:c})}},{key:"setAnimatedLayout",value:function(e,t){var n=this.props.transition;this.animatedStyles=n?animatedStyles(n,e,t):{}}},{key:"componentWillReceiveProps",value:function(e){this.hasLayoutChanged(e)&&this.setAnimatedLayout(e.indexes,e.layout)}},{key:"hasLayoutChanged",value:function(e){if(e.indexes){var t=e.layout.width,n=e.indexes,a=n.screen,r=n.relative,i=this.props,o=i.layout,s=i.indexes;return t!==o.width||a!==s.screen||r!==s.relative||this.props.transition!==e.transition}}},{key:"componentWillUnmount",value:function(){this.props.onUnmount(this.props.item.key)}}]),t}();_defineProperty(ScreenWrapper,"defaultProps",{onReady:nofn,onUnmount:nofn});var styles=reactNative.StyleSheet.create({container:{overflow:"hidden",position:"absolute",top:0,left:0,bottom:0,right:0,zIndex:10}}),isWeb="web"===reactNative.Platform.OS,defaultDuration=500,TransitionElement=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).indexes=n.getIndexes(),n.animatedValue=new reactNative.Animated.Value(n.indexes.leaving),n.transition=n.getTransition(),n}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){if(!1===this.transition)return null;var e=[styles$1.container,this.props.leaving.props.style,animatedStyles(this.transition,{transition:this.animatedValue})];return React__default.createElement(reactNative.Animated.View,{style:e,pointerEvents:"auto"},this.renderChildren())}},{key:"renderChildren",value:function(){var e=this.props,t=e.leaving.props.transitionRender;return t?t({animatedValue:this.animatedValue,breakPoint:e.breakPoint,entering:e.entering,leaving:e.leaving}):e.leaving.props.children}},{key:"getTransition",value:function(){var e,t=this.props.leaving.props.transition,n=this.getDefaultTransition();if("function"==typeof t){var a=this.props;e=t({breakPoint:a.breakPoint,entering:a.entering,leaving:a.leaving,defaultTransition:Object.assign({},n)})}else e=t;if(!1===e)return!1;if(void 0===e)return n;e.duration||(e.duration=n.duration);var r=e.styles,i=n.styles;return r||(r={},e.style=r),Object.keys(i).forEach(function(e){void 0===r[e]&&(r[e]=i[e])}),e}},{key:"getIndexes",value:function(){return{entering:this.props.entering.props.transitionState||this.props.screenIndexes.entering,leaving:this.props.leaving.props.transitionState||this.props.screenIndexes.leaving}}},{key:"getDefaultTransition",value:function(){var e=this.indexes,t=e.leaving,n=e.entering,a=this.props.leaving.box,r=this.props.entering.box,i=this.props.leavingTransition;return{styles:{width:this.getInterpolation(t,n,a.width,r.width),height:this.getInterpolation(t,n,a.height,r.height),translateX:this.getInterpolation(t,n,a.x,r.x),translateY:this.getInterpolation(t,n,a.y,r.y)},duration:i&&i.duration||defaultDuration}}},{key:"getInterpolation",value:function(e,t,n,a){if(n===a)return n;var r=e>t;return{inputRange:r?[t,e]:[e,t],outputRange:r?[a,n]:[n,a]}}},{key:"componentDidMount",value:function(){var e=this;console.log("Mounted",this.props.entering.box,this.props.leaving.box),!1!==this.transition&&reactNative.Animated.timing(this.animatedValue,{toValue:this.indexes.entering,duration:this.transition.duration||defaultDuration}).start(function(){return e.props.onTransitionEnd()})}}]),t}();_defineProperty(TransitionElement,"propTypes",{entering:PropTypes.object,leaving:PropTypes.object,breakPoint:PropTypes.number,screenIndexes:PropTypes.object});var styles$1=reactNative.StyleSheet.create({container:{position:"absolute",overflow:"hidden",top:0,left:0}}),Context$1=React__default.createContext("sharedElement"),mountedElements={};function register(e,t){var n=t.wrapper.id;mountedElements[n]||(mountedElements[n]=[]),mountedElements[n].push(e)}function unregister(e){var t=e.props.wrapper.id,n=mountedElements[t];if(n&&n)for(var a=n.length;a-- >0;)n[a]===e&&n.splice(a,1)}var breakPoint,screenIndexes,clbks=[];function reMeasure(e,t,n){var a=Object.keys(mountedElements);if(!(a.length<2)){breakPoint=t,screenIndexes=n;var r={x:e.x,y:e.y};a.forEach(function(e){mountedElements[e].forEach(function(e){e.measure(r)})})}}function startTransition(e,t,n,a){clbks.forEach(function(r){return r(e,t,n,a)})}var TransitionLayer=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).state={elements:[]},n.checkForTransitions=n.checkForTransitions.bind(_assertThisInitialized(n)),n}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props.layout,t={top:e.y||0,right:(e.x||0)+e.width,left:e.x||0,bottom:(e.y||0)+e.height},n=this.state.elements,a=Object.keys(n).map(function(e){return n[e]});return a.length>0&&console.log("couples found, rendering",a.length),React__default.createElement(reactNative.View,{style:[styles$2.container,t],pointerEvents:"none"},a)}},{key:"checkForTransitions",value:function(e,t,n,a){var r=this.getTransitionCouples(e,t);r.length&&(this.leavingTransition=a,this.waitForReadyAndRender(r,n))}},{key:"waitForReadyAndRender",value:function(e,t){for(var n=this,a=e.length;a-- >0;)if(!e[a].leaving.box||!e[a].entering.box)return setTimeout(function(){return n.waitForReadyAndRender(e,t)});var r={};e.forEach(function(e){var t=createId();r[t]=n.renderElement(e,t)}),this.setState({elements:r})}},{key:"renderElement",value:function(e,t){var n=this,a=e.leaving,r=e.entering;return React__default.createElement(TransitionElement,{key:t,leaving:a,entering:r,breakPoint:breakPoint,screenIndexes:screenIndexes,leavingTransition:this.leavingTransition&&this.leavingTransition(breakPoint),onTransitionEnd:function(){return n.removeElement(t)}})}},{key:"removeElement",value:function(e){var t=Object.assign({},this.state.elements);delete t[e],this.setState({elements:t})}},{key:"cleanProps",value:function(e){var t={};return Object.keys(e).forEach(function(n){"se"!==n&&"wrapper"!==n&&"children"!==n&&"transitionStyles"!==n&&(t[n]=e[n])}),t}},{key:"getTransitionCouples",value:function(e,t){var n={},a=[];return e.forEach(function(e){mountedElements[e]&&mountedElements[e].forEach(function(e){n[e.props.sharedId]=e})}),t.forEach(function(e){mountedElements[e]&&mountedElements[e].forEach(function(e){n[e.props.sharedId]&&a.push({leaving:n[e.props.sharedId],entering:e})})}),a}},{key:"componentDidMount",value:function(){clbks.push(this.checkForTransitions)}},{key:"componentWillUnmount",value:function(){for(var e=clbks.length;e-- >0;)clbks[e]===this.checkForTransitions&&clbks.splice(e,1)}}]),t}(),styles$2=reactNative.StyleSheet.create({container:{position:"absolute",zIndex:1e4}}),SharedElementWrapper=function(e){return React__default.createElement(Context$1.Provider,{value:{register:register,unregister:unregister,startTransition:startTransition,reMeasure:reMeasure}},e.children,React__default.createElement(TransitionLayer,{router:e.router,layout:e.layout}))},isWeb$1="web"===reactNative.Platform.OS,ScreenStack=function(e){function t(e){var n;_classCallCheck(this,t),n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e));var a=e.stack,r=e.index;return n.state={indexes:n.calculateIndexes({},a,r),layout:!1},n.previousIndex=r,n.previousScreen=a[r].key,n.calculateIndexes=memoize(n.calculateIndexes.bind(_assertThisInitialized(n))),n.updateRelativeIndexes=memoize(n.updateRelativeIndexes.bind(_assertThisInitialized(n))),n.readyScreens={},bind(_assertThisInitialized(n),["_onScreenReady","_onScreenUnmount"]),n}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.stack,a=t.router,r=[styles$3.container,this.animatedStyles];return React__default.createElement(reactNative.Animated.View,{style:r},React__default.createElement(reactNative.View,{style:styles$3.stack,onLayout:function(t){return e.updateLayout(t)}},this.renderScreens(a,n)))}},{key:"renderScreens",value:function(e,n){var a=this,r=this.state,i=r.layout,o=r.indexes;if(i){var s=[];return n.forEach(function(n){var r=n.key;o[r]&&s.push(React__default.createElement(ScreenWrapper,{item:n,ScreenStack:t,router:e,indexes:o[r],layout:i,transition:a.getScreenTransition(n.Screen),onReady:a._onScreenReady,onUnmount:a._onScreenUnmount,drawer:a.props.drawer,breakPoint:a.props.breakPoint,key:r}))}),s}}},{key:"getScreenTransition",value:function(e){if("function"==typeof e.getTransition){var t=e.getTransition(this.props.breakPoint);if(!1===t)return;if(t)return t}return this.props.screenTransition}},{key:"updateLayout",value:function(e){this.setState({layout:e.nativeEvent.layout}),this.animatedStyles=animatedStyles(this.props.stackTransition,this.props.stackIndexes,e.nativeEvent.layout)}},{key:"componentDidUpdate",value:function(){var e=this,t=this.props,n=t.stack,a=t.index,r=t.screenTransition,i=this.calculateIndexes(this.state.indexes,n,this.previousIndex,r);if(i!==this.state.indexes&&this.setState({indexes:i}),this.needRelativeUpdate){this.context.reMeasure(this.props.layout,this.props.breakPoint,this.transitionIndexes),this.transitionIndexes=!1;var o=this.updateRelativeIndexes(i,n,a);setTimeout(function(){e.needRelativeUpdate=!1,e.startTransition(e.state.indexes,o),e.setState({indexes:o})})}a===this.previousIndex&&n[a].key===this.previousScreen||(this.transitionIndexes={leaving:this.previousIndex,entering:a},this.needRelativeUpdate=!0,this.previousIndex=a,this.previousScreen=n[a].key,this.forceUpdate())}},{key:"calculateIndexes",value:function(e,t,n){var a=this,r=t.length,i=Object.assign({},e),o=Object.assign({},e),s=!1;return t.forEach(function(e,t){var c=e.key;if(o[c])return delete o[c];s=!0,i[c]={screen:t,count:r,relative:n-t,transition:new reactNative.Animated.Value(n-t),parent:a.props.parentIndexes}}),Object.keys(o).forEach(function(e){delete i[e],s=!0}),s?i:e}},{key:"updateRelativeIndexes",value:function(e,t,n){var a=this,r=Object.assign({},e),i=t.length;return t.forEach(function(e,t){var o=e.key,s={screen:t,count:i,relative:n-t,transition:r[o].transition,parent:a.props.parentIndexes};r[o]=s}),r}},{key:"startTransition",value:function(e,t){var n,a,r,i=this;this.props.stack.forEach(function(o){var s=o.key,c=o.Screen,u=e[s],l=t[s];if(0===u.relative&&(n=o),0===l.relative&&(a=o,r=u.relative),u&&l&&u.relative!==l.relative){var h=i.getScreenTransition(c);reactNative.Animated.timing(l.transition,{toValue:l.relative,easing:h.easing,duration:h.duration||300,useNativeDriver:!isWeb$1}).start()}}),n&&a&&this.context.startTransition(this.getActiveScreens(n),this.getActiveScreens(a),r,n.Screen.getTransition)}},{key:"getActiveScreens",value:function(e){var t=[e.key],n=e.tabs;return n&&(t=t.concat(this.getActiveScreens(n.stack[n.activeIndex]))),t}},{key:"_onScreenReady",value:function(e){this.readyScreens[e]=1}},{key:"_onScreenUnmount",value:function(e){delete this.readyScreens[e]}}]),t}();_defineProperty(ScreenStack,"propTypes",{router:PropTypes.object,screenTransition:PropTypes.object,stackTransition:PropTypes.object,stackIndexes:PropTypes.object,stack:PropTypes.array,index:PropTypes.number,layout:PropTypes.object}),_defineProperty(ScreenStack,"defaultProps",{stackTransition:{},stackIndexes:{}}),_defineProperty(ScreenStack,"contextType",Context$1);var styles$3=reactNative.StyleSheet.create({container:{flex:1,position:"relative",zIndex:1},drawer:{},stack:{height:"100%",width:"100%"}}),ModalWrapper=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).setAnimatedLayout(e.indexes,e.layout),n}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=[styles$4.container,this.animatedStyles],t=this.props.stack[0],n=t?React__default.createElement(t.Screen,null):React__default.createElement(reactNative.View,null);return React__default.createElement(reactNative.Animated.View,{style:e},n)}},{key:"getScreenItem",value:function(e){return e&&e!==this.item&&(this.item=e),this.item}},{key:"setAnimatedLayout",value:function(e,t){this.animatedStyles=animatedStyles(this.props.transition,e,t)}},{key:"componentWillReceiveProps",value:function(e){this.hasLayoutChanged(e)&&this.setAnimatedLayout(e.indexes,e.layout)}},{key:"hasLayoutChanged",value:function(e){if(e.indexes){var t=e.layout.width,n=e.indexes.showing,a=this.props,r=a.layout,i=a.indexes;return t!==r.width||n!==i.showing}}}]),t}(),styles$4=reactNative.StyleSheet.create({container:{overflow:"hidden",position:"absolute",width:"100%",height:"100%",top:0,left:0,zIndex:10,shadowColor:"#000",shadowOpacity:.1,shadowRadius:10,elevation:3}}),handleWidth=30,DrawerWrapper=function(e){function t(e){var n;_classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).drawerWidth=300,n.drawerPos=new reactNative.Animated.Value(0),n.calculateDrawerIndex(),n.state={open:!1},n.overlayAnimStyle={transform:[{translateX:n.drawerIndex.interpolate({inputRange:[0,.01,1],outputRange:[-1e4,0,0]})}],opacity:n.drawerIndex.interpolate({inputRange:[0,0,1,1],outputRange:[0,0,.5,.5]})};var a={open:function(){return n.openDrawer()},close:function(){return n.closeDrawer()}};return n._drawerMethods=a,n}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e,t,n=this,a=this.props,r=a.Drawer,i=a.router,o=a.collapsible;o&&(e=React__default.createElement(reactNative.View,{style:styles$5.handle}),t=React__default.createElement(reactNative.Animated.View,{style:[styles$5.overlay,this.overlayAnimStyle],onClick:function(){return n.closeDrawer()}}));var s=this.state.open?2*this.drawerWidth:this.drawerWidth+handleWidth,c=[styles$5.container,o&&styles$5.collapsibleContainer,o&&{width:s,left:handleWidth-this.drawerWidth},this.animatedStyles],u=[styles$5.drawer,o&&styles$5.collapsibleDrawer],l=[{x:0,id:"closed"},{x:this.drawerWidth-handleWidth-10,id:"open"}];return React__default.createElement(reactNative.Animated.View,{style:c},t,React__default.createElement(Interactable.View,{dragEnabled:!!o,ref:"drawer",horizontalOnly:!0,snapPoints:l,boundaries:{right:this.drawerWidth-handleWidth,bounce:0},onDrag:function(e){return n.onDrag(e)},animatedValueX:this.drawerPos},React__default.createElement(reactNative.View,{style:u,ref:"layout",onLayout:function(e){return n.updateLayout(e)}},React__default.createElement(r,{router:i,drawer:this._drawerMethods}),e)))}},{key:"updateLayout",value:function(e){var t=e.nativeEvent.layout;this.animatedStyles=animatedStyles(this.props.transition,this.props.indexes,t),this.drawerWidth=t.width,this.calculateDrawerIndex(),this.forceUpdate()}},{key:"componentDidUpdate",value:function(e){var t=this;e.collapsible!==this.props.collapsible&&this.drawerPos.setValue(0),e.breakPoint!==this.props.breakPoint&&this.refs.layout.measure(function(e,n,a,r,i,o){t.updateLayout({nativeEvent:{layout:{width:a,height:r,x:i,y:o}}})})}},{key:"calculateDrawerIndex",value:function(){var e=this.drawerIndex,t=this.drawerPos.interpolate({inputRange:[0,this.drawerWidth],outputRange:[0,1]});e?(e._config=t._config,e._interpolation=t._interpolation):this.drawerIndex=t}},{key:"openDrawer",value:function(){if(this.props.collapsible&&!this.state.open){var e=this.refs.drawer;this.setState({open:!0}),e&&e.setVelocity({x:2e3})}}},{key:"closeDrawer",value:function(){if(this.props.collapsible&&this.state.open){var e=this.refs.drawer;this.setState({open:!1}),e&&e.setVelocity({x:-2e3})}}},{key:"onDrag",value:function(e){e.nativeEvent&&(e=e.nativeEvent),"start"===e.state?this.setState({open:!0}):"end"===e.state&&"closed"===e.targetSnapPointId&&this.setState({open:!1})}}]),t}(),styles$5=reactNative.StyleSheet.create({container:{flexDirection:"row"},collapsibleContainer:{position:"absolute",top:0,bottom:0,zIndex:2e3},drawer:{top:0,left:0,height:"100%",width:"100%",flex:1},collapsibleDrawer:{left:0,width:"100%",flex:1,position:"relative",zIndex:2e4,paddingRight:handleWidth},handle:{width:handleWidth,top:0,bottom:0,right:0,position:"absolute",zIndex:10},overlay:{backgroundColor:"black",height:"100%",width:"400%",position:"absolute"},expander:{position:"absolute",height:"100%",top:0,left:0,bottom:0}}),desktopTransition={styles:function(e,t){var n=e.screen?400:0;return{width:{inputRange:[-2,-1,0,1,2,3],outputRange:[0,0,t.width-n,400,0,0]},translateX:{inputRange:[-2,-1,0,1,2],outputRange:[t.width,t.width,n,0,0]}}},easing:reactNative.Easing.linear,duration:300},mobileTransition={styles:function(e,t){return{translateX:{inputRange:[-2,-1,0,1],outputRange:[t.width,t.width,0,0]},opacity:{inputRange:[-2,-1,0,.8,1],outputRange:[0,1,1,0,0]},scale:{inputRange:[-1,0,1,2],outputRange:[1,1,.5,.5]}}},duration:300,collapsibleDrawer:!0},stackAndDrawer={styles:{translateY:{inputRange:[0,1],outputRange:[-100,0]},opacity:{inputRange:[0,1],outputRange:[0,1]}},easing:reactNative.Easing.linear,duration:300},modalTransition={stack:stackAndDrawer,drawer:stackAndDrawer,modal:{styles:function(e,t){return{translateY:{inputRange:[0,1],outputRange:[t.height,0]}}},easing:reactNative.Easing.linear,duration:300}},isWeb$2="web"===reactNative.Platform.OS,Navigator=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).state={layout:n.getWindowSize()},n.calculateTransition(e.transitions,n.state.layout.width),n.getScreenStack=memoize(n.getScreenStack),n._onBack=n._onBack.bind(_assertThisInitialized(n)),n.drawer={open:function(){return n.drawerInstance.openDrawer()},close:function(){return n.drawerInstance.closeDrawer()}},reactNative.BackHandler.addEventListener("hardwareBackPress",n._onBack),n}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this,t=this.router;if(!t)return null;var n=this.props,a=n.DrawerComponent,r=(n.transitions,this.state),i=r.layout,o=r.indexes,s=this.currentTransition,c=this.currentBreakpoint,u=this.getModalTransitions(s),l=this.getScreenStack(t.stack,t.activeIndex),h=l.stack,d=l.index;return React__default.createElement(SharedElementWrapper,{router:t,layout:i},React__default.createElement(reactNative.View,{style:styles$6.windowWrapper},React__default.createElement(reactNative.View,{style:styles$6.container,onLayout:function(t){return e._onLayout(t.nativeEvent.layout)}},React__default.createElement(DrawerWrapper,{ref:function(t){return e.drawerInstance=t},router:t,transition:u.drawer,breakPoint:c,indexes:o.stack,collapsible:s.collapsibleDrawer,Drawer:a}),React__default.createElement(ScreenStack,{router:t,screenTransition:s,stackTransition:u.stack,stackIndexes:o.stack,breakPoint:c,stack:h,index:d,layout:i,drawer:this.drawer}),React__default.createElement(ModalWrapper,{router:t,stack:t.modal.stack,index:t.modal.stack,transition:u.modal,breakPoint:c,indexes:o.modal,layout:i,drawer:this.drawer}))))}},{key:"calculateTransition",value:function(e,t){for(var n=Object.keys(e).sort(function(e,t){return e-t}),a=n.length;a-- >0;)if(t>=parseInt(n[a]))return this.currentTransition=e[n[a]],void(this.currentBreakpoint=parseInt(n[a]));this.currentTransition=e[n[0]],this.currentBreakpoint=parseInt(n[0])}},{key:"getModalTransitions",value:function(e){return(e||this.currentTransition).modalTransition||modalTransition}},{key:"getScreenStack",value:function(e,t){var n=e.slice(),a=t,r=e.length-1;return(n[r].Screen.urlstackOptions||{}).modal&&(n.pop(),a===r&&a--),{stack:n,index:a}}},{key:"startRouter",value:function(){var e=this,t=create(this.props.routes),n=this.props.interceptor;n&&t.onBeforeChange(n),this.fu=function(){return e.forceUpdate()},t.onChange(function(){return e.fu()}),t.start(),this.router=t,this.showingModal=this.detectModal(),this.updateModalIndexes(this.showingModal)}},{key:"getWindowSize",value:function(){var e=reactNative.Dimensions.get("window");return{width:e.width,height:e.height,x:0,y:0}}},{key:"componentDidMount",value:function(){this.startRouter()}},{key:"componentWillUnmount",value:function(){this.fu=function(){},reactNative.BackHandler.removeEventListener("hardwareBackPress",this._onBack)}},{key:"componentDidUpdate",value:function(e){var t=this.detectModal();this.showingModal!==t&&(this.showingModal=t,this.updateModalIndexes(t)),e.transistions!==this.props.transistions&&this.calculateTransition(this.props.transitions,this.state.layout.width)}},{key:"_onLayout",value:function(e){console.log(e),this.calculateTransition(this.props.transitions,e.width),this.setState({layout:e})}},{key:"_onBack",value:function(){var e,t=this.router,n=t.stack;if(t.modal.active?e=t.modal.activeIndex?t.modal.stack[t.modal.activeIndex-1].path:(e=n[t.activeIndex].location).pathname+e.search:t.activeIndex&&(e=n[t.activeIndex-1].path),e)return t.navigate(e),!0}},{key:"detectModal",value:function(){return this.router.modal.active}},{key:"updateModalIndexes",value:function(e){var t=this.state.indexes;if(t){var n=this.getModalTransitions();t={modal:{showing:!!e,transition:t.modal.transition},stack:{showing:!e,transition:t.stack.transition}},reactNative.Animated.timing(t.modal.transition,{toValue:e?1:0,easing:n.modal.easing,duration:n.modal.duration||300,useNativeDriver:!isWeb$2}).start(),reactNative.Animated.timing(t.stack.transition,{toValue:e?0:1,easing:n.stack.easing,duration:n.stack.duration||300,useNativeDriver:!isWeb$2}).start()}else t={modal:{showing:!!e,transition:new reactNative.Animated.Value(e?1:0)},stack:{showing:!e,transition:new reactNative.Animated.Value(e?0:1)}};this.setState({indexes:t})}}]),t}();_defineProperty(Navigator,"propTypes",{transitions:PropTypes.object,interceptor:PropTypes.func}),_defineProperty(Navigator,"defaultProps",{transitions:{0:mobileTransition,800:desktopTransition}});var statusBarHeight="android"===reactNative.Platform.OS?reactNative.StatusBar.currentHeight:0;"web"===reactNative.Platform.OS&&(statusBarHeight=20);var styles$6=reactNative.StyleSheet.create({windowWrapper:{paddingTop:statusBarHeight,flex:1},container:{flex:1,flexDirection:"row",overflow:"hidden"}}),isWeb$3="web"===reactNative.Platform.OS,SharedElement=function(e){function t(e){var n;return _classCallCheck(this,t),n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e)),e.se.register(_assertThisInitialized(n),e),n}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this;return React__default.createElement(reactNative.View,{style:this.props.style,ref:"el",onLayout:function(){return e._onLayout()},pointerEvents:"auto"},this.props.children)}},{key:"componentWillUnmount",value:function(){this.props.se.unregister(this)}},{key:"measure",value:function(e){var t=this;if(this.box=!1,!isWeb$3&&!this.layouted)return console.log("skipping"),setTimeout(function(){return t.measure(e)});this.refs.el&&this.refs.el.measure(function(n,a,r,i,o,s){t.box={width:r,height:i,x:o-e.x,y:s-e.y},console.log("measured")})}},{key:"_onLayout",value:function(){this.layouted=!0}}]),t}();function ContextConsumerHOC(e){return function(t){return React__default.createElement(Context$1.Consumer,null,function(n){return React__default.createElement(Context.Consumer,null,function(a){return React__default.createElement(e,_extends({},t,{se:n,wrapper:a}))})})}}_defineProperty(SharedElement,"propTypes",{transition:PropTypes.oneOf([PropTypes.object,PropTypes.func]),transitionRender:PropTypes.func,transitionState:PropTypes.number,sharedId:PropTypes.string}),_defineProperty(SharedElement,"defaultTypes",{});var SharedElementWithContext=ContextConsumerHOC(SharedElement);exports.Navigator=Navigator,exports.SharedElement=SharedElementWithContext,exports.animatedStyles=animatedStyles,exports.stagger=stagger;
//# sourceMappingURL=react-urlstack.js.map
